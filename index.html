<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ñ–∏–∑–Ω—å –ú–∞—Ç–≤–µ—è - –°–∏–º—É–ª—è—Ç–æ—Ä –≤—ã–∂–∏–≤–∞–Ω–∏—è</title>
    <!-- Telegram Web App SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --color-bg: #1a1a1a;
            --color-surface: #2a2a2a;
            --color-text: #e0e0e0;
            --color-text-dim: #999;
            --color-primary: #4a9eff;
            --color-danger: #ff4444;
            --color-warning: #ffaa00;
            --color-success: #44ff44;
            --color-border: #444;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--color-bg);
            color: var(--color-text);
            line-height: 1.6;
            padding: 20px;
        }

        /* Telegram Mini App adaptations */
        body.telegram {
            padding: 10px;
            background: var(--tg-theme-bg-color, #1a1a1a);
            color: var(--tg-theme-text-color, #e0e0e0);
        }

        .telegram .game-container {
            max-width: 100%;
        }

        .telegram header {
            margin-bottom: 15px;
            padding: 15px;
        }

        .telegram h1 {
            font-size: 1.8em;
        }

        .telegram .action-btn {
            min-height: 50px;
            font-size: 1.05em;
            touch-action: manipulation;
        }

        .telegram .main-content {
            gap: 15px;
        }

        .telegram .stat-item {
            margin-bottom: 8px;
        }

        .game-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: var(--color-surface);
            border-radius: 10px;
            border: 2px solid var(--color-border);
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            color: var(--color-primary);
        }

        .subtitle {
            color: var(--color-text-dim);
            font-size: 1.1em;
        }

        .day-counter {
            font-size: 1.5em;
            margin-top: 10px;
            color: var(--color-warning);
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
            margin-bottom: 20px;
            align-items: start;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .stats-panel {
            background: var(--color-surface);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid var(--color-border);
        }

        .stat {
            margin-bottom: 20px;
        }

        .stat-name {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .stat-value {
            color: var(--color-text-dim);
        }

        .progress-bar {
            height: 20px;
            background: #333;
            border-radius: 10px;
            overflow: hidden;
            border: 1px solid var(--color-border);
        }

        .progress-fill {
            height: 100%;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8em;
            font-weight: bold;
        }

        .progress-health { background: linear-gradient(90deg, #ff4444, #ff6666); }
        .progress-mood-red { background: linear-gradient(90deg, #ff4444, #ff6666); }
        .progress-mood-orange { background: linear-gradient(90deg, #ffaa00, #ffcc44); }
        .progress-mood-yellow { background: linear-gradient(90deg, #ffdd44, #ffee66); }
        .progress-mood-green { background: linear-gradient(90deg, #44ff44, #66ff66); }
        .progress-satiety { background: linear-gradient(90deg, #44ff44, #66ff66); }
        .progress-adequacy { background: linear-gradient(90deg, #4a9eff, #6ab0ff); }
        .progress-incel { background: linear-gradient(90deg, #9944ff, #aa66ff); }
        .progress-god { background: linear-gradient(90deg, #ff00ff, #ff44ff); }
        .progress-fatigue-low { background: linear-gradient(90deg, #44ff44, #66ff66); }
        .progress-fatigue-medium { background: linear-gradient(90deg, #ffaa00, #ffcc44); }
        .progress-fatigue-high { background: linear-gradient(90deg, #ff4444, #ff6666); }

        .money-display {
            font-size: 1.5em;
            color: var(--color-success);
            text-align: center;
            padding: 15px;
            background: #1a3a1a;
            border-radius: 10px;
            margin-top: 20px;
            border: 2px solid var(--color-success);
        }

        .money-display.debt {
            color: var(--color-danger);
            background: #3a1a1a;
            border-color: var(--color-danger);
            animation: pulse 1.5s infinite;
        }

        .debt-counter {
            font-size: 0.9em;
            color: var(--color-danger);
            text-align: center;
            padding: 10px;
            background: #3a1a1a;
            border-radius: 8px;
            margin-top: 10px;
            border: 2px solid var(--color-danger);
            animation: pulse 2s infinite;
        }

        .debt-counter.critical {
            animation: pulse 0.8s infinite;
            font-weight: bold;
        }

        .event-log {
            background: var(--color-surface);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid var(--color-border);
            height: 600px;
            max-height: 600px;
            overflow-y: auto;
            overflow-x: hidden;
            position: relative;
        }

        #eventLog {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .event-log::-webkit-scrollbar {
            width: 10px;
        }

        .event-log::-webkit-scrollbar-track {
            background: #1a1a1a;
            border-radius: 5px;
        }

        .event-log::-webkit-scrollbar-thumb {
            background: var(--color-border);
            border-radius: 5px;
        }

        .event-log::-webkit-scrollbar-thumb:hover {
            background: var(--color-primary);
        }



        .event-log h2 {
            color: var(--color-primary);
        }

        .log-entry {
            padding: 10px;
            margin-bottom: 10px;
            background: #1a1a1a;
            border-radius: 5px;
            border-left: 3px solid var(--color-primary);
            animation: slideIn 0.3s ease;
        }

        .log-entry.event {
            border-left-color: var(--color-warning);
        }

        .log-entry.danger {
            border-left-color: var(--color-danger);
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .actions-panel {
            background: var(--color-surface);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid var(--color-border);
        }

        .actions-panel h2 {
            margin-bottom: 15px;
            color: var(--color-primary);
        }

        .actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
        }

        .action-btn {
            padding: 15px;
            background: #333;
            border: 2px solid var(--color-border);
            border-radius: 8px;
            color: var(--color-text);
            font-size: 1em;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: left;
        }

        .action-btn:hover:not(:disabled) {
            background: #444;
            border-color: var(--color-primary);
            transform: translateY(-2px);
        }

        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .action-btn.primary {
            background: var(--color-primary);
            color: #fff;
            font-weight: bold;
        }

        .action-btn.primary:hover:not(:disabled) {
            background: #3a8eef;
        }

        .action-icon {
            font-size: 1.5em;
            margin-right: 8px;
        }

        .achievements {
            background: var(--color-surface);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid var(--color-border);
            margin-top: 20px;
        }

        .achievements h2 {
            margin-bottom: 15px;
            color: var(--color-warning);
        }

        .achievement {
            display: inline-block;
            padding: 8px 15px;
            margin: 5px;
            background: #1a1a1a;
            border-radius: 20px;
            border: 2px solid var(--color-warning);
            font-size: 0.9em;
        }

        .achievement.locked {
            opacity: 0.3;
            border-color: var(--color-border);
        }

        .game-over-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .game-over-content {
            background: var(--color-surface);
            padding: 40px;
            border-radius: 15px;
            border: 3px solid var(--color-danger);
            text-align: center;
            max-width: 500px;
        }

        .game-over-content h2 {
            font-size: 3em;
            color: var(--color-danger);
            margin-bottom: 20px;
        }

        .restart-btn {
            margin-top: 20px;
            padding: 15px 40px;
            background: var(--color-primary);
            border: none;
            border-radius: 8px;
            color: #fff;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .restart-btn:hover {
            background: #3a8eef;
            transform: scale(1.05);
        }

        .stat-alert {
            color: var(--color-danger);
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Toast notification */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            z-index: 9999;
            animation: slideInRight 0.5s ease-out;
            max-width: 400px;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .toast.hidden {
            display: none;
        }

        .toast-content {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .toast-icon {
            font-size: 2em;
        }

        .toast-text {
            flex: 1;
            line-height: 1.4;
        }

        .toast-text strong {
            font-size: 1.1em;
            display: block;
            margin-bottom: 5px;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }

        .toast.fade-out {
            animation: slideOutRight 0.5s ease-in forwards;
        }

        @media (max-width: 768px) {
            .toast {
                top: 10px;
                right: 10px;
                left: 10px;
                max-width: none;
            }
        }

        /* Tooltips */
        .action-btn {
            position: relative;
        }

        .action-btn::before {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%) translateY(-8px);
            background: #1a1a1a;
            color: #ffffff;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.9em;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease, transform 0.3s ease;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
            border: 1px solid #333;
        }

        .action-btn::after {
            content: '';
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%) translateY(0);
            border: 6px solid transparent;
            border-top-color: #1a1a1a;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease, transform 0.3s ease;
            z-index: 1000;
        }

        .action-btn:hover::before,
        .action-btn:hover::after {
            opacity: 1;
        }

        .action-btn:hover::before {
            transform: translateX(-50%) translateY(-12px);
        }

        .action-btn:hover::after {
            transform: translateX(-50%) translateY(-6px);
        }

        .action-btn:disabled::before {
            background: #ff4444;
            border-color: #ff6666;
        }

        .action-btn:disabled::after {
            border-top-color: #ff4444;
        }

        .action-btn:hover {
            transform: translateY(-2px) scale(1.02);
        }

        .action-btn:disabled:hover {
            transform: none;
        }

        @media (max-width: 768px) {
            .action-btn::before {
                font-size: 0.75em;
                padding: 6px 10px;
                white-space: normal;
                max-width: 200px;
                text-align: center;
            }
        }

        .work-choice-card {
            transition: all 0.2s ease;
        }

        .work-choice-card:hover {
            border-color: var(--color-primary) !important;
            transform: translateY(-4px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
        }
    </style>
</head>
<body>
    <div class="game-container">
        <header>
            <h1>üèôÔ∏è –ñ–∏–∑–Ω—å –ú–∞—Ç–≤–µ—è</h1>
            <p class="subtitle">–°–∏–º—É–ª—è—Ç–æ—Ä –≤—ã–∂–∏–≤–∞–Ω–∏—è –≤ –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥–µ</p>
            <div class="day-counter">–î–µ–Ω—å: <span id="dayCounter">1</span></div>
        </header>

        <div class="main-content">
            <div class="stats-panel">
                <h2>üìä –ü–∞—Ä–∞–º–µ—Ç—Ä—ã</h2>
                
                <div class="stat">
                    <div class="stat-name">
                        <span>‚ù§Ô∏è –ó–¥–æ—Ä–æ–≤—å–µ</span>
                        <span class="stat-value" id="healthValue">100</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill progress-health" id="healthBar" style="width: 100%"></div>
                    </div>
                </div>

                <div class="stat">
                    <div class="stat-name">
                        <span>üòä –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ</span>
                        <span class="stat-value" id="moodValue">50</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill progress-mood" id="moodBar" style="width: 50%"></div>
                    </div>
                </div>

                <div class="stat">
                    <div class="stat-name">
                        <span>üçî –°—ã—Ç–æ—Å—Ç—å</span>
                        <span class="stat-value" id="satietyValue">100</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill progress-satiety" id="satietyBar" style="width: 100%"></div>
                    </div>
                </div>

                <div class="stat">
                    <div class="stat-name">
                        <span>üß† –ê–¥–µ–∫–≤–∞—Ç–Ω–æ—Å—Ç—å</span>
                        <span class="stat-value" id="adequacyValue">20</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill progress-adequacy" id="adequacyBar" style="width: 20%"></div>
                    </div>
                </div>

                <div class="stat">
                    <div class="stat-name">
                        <span>ü§° –ò–Ω—Ü–µ–ª—å–Ω–æ—Å—Ç—å</span>
                        <span class="stat-value" id="incelValue">80</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill progress-incel" id="incelBar" style="width: 80%"></div>
                    </div>
                </div>

                <div class="stat">
                    <div class="stat-name">
                        <span>üëë –ö–æ–º–ø–ª–µ–∫—Å –ë–æ–≥–∞</span>
                        <span class="stat-value" id="godComplexValue">40</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill progress-god" id="godComplexBar" style="width: 40%"></div>
                    </div>
                </div>

                <div class="stat">
                    <div class="stat-name">
                        <span>üò¥ –£—Å—Ç–∞–ª–æ—Å—Ç—å</span>
                        <span class="stat-value" id="fatigueValue">0</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill progress-fatigue-low" id="fatigueBar" style="width: 0%"></div>
                    </div>
                </div>

                <div class="money-display" id="moneyDisplay">
                    üí∞ <span id="moneyValue">25,000</span> ‚ÇΩ
                </div>
                <div class="debt-counter" id="debtCounter" style="display: none;">
                    ‚ö†Ô∏è –î–Ω–µ–π –≤ –¥–æ–ª–≥—É: <span id="debtDays">0</span>/7
                </div>

                <div class="stat" style="margin-top: 20px;">
                    <div class="stat-name">
                        <span>üíñ –û—Ç–Ω–æ—à–µ–Ω–∏—è —Å –í–∏–∫–æ–π</span>
                        <span class="stat-value" id="vikaRelationshipValue">0</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="vikaRelationshipBar" style="width: 0%; background: linear-gradient(90deg, #ff1493, #ff69b4);"></div>
                    </div>
                    <div style="font-size: 0.85em; color: var(--color-text-dim); margin-top: 5px;">–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —à–∞–Ω—Å –∫–æ–Ω—Ç–∞–∫—Ç–∞ –∏ —Ñ–∏–Ω–∞–ª—å–Ω—É—é –∫–æ–Ω—Ü–æ–≤–∫—É</div>
                </div>
            </div>

            <div class="event-log">
                <h2 style="position: sticky; top: 0; background: var(--color-surface); z-index: 10; margin: -20px -20px 15px -20px; padding: 20px; border-bottom: 2px solid var(--color-border);">üìú –°–æ–±—ã—Ç–∏—è</h2>
                <div id="eventLog">
                    <!-- Events dynamically added here via JavaScript -->
                </div>
            </div>
        </div>

        <div class="actions-panel">
            <h2>üéÆ –î–µ–π—Å—Ç–≤–∏—è</h2>
            <div class="actions-grid">
                <button class="action-btn" onclick="work()" data-tooltip="–í—ã–±–µ—Ä–∏: –ê—Å—Ñ–∞–ª—å—Ç (—Ç—è–∂–µ–ª–æ, 2200-3800‚ÇΩ) –∏–ª–∏ –î–æ—Å—Ç–∞–≤–∫–∞ (–ª–µ–≥—á–µ, 800-1500‚ÇΩ)"><span class="action-icon">üíº</span>–†–∞–±–æ—Ç–∞—Ç—å</button>
                <button class="action-btn" onclick="wash()" data-tooltip="üß† +8 –∞–¥–µ–∫–≤–∞—Ç–Ω–æ—Å—Ç–∏ | üîª -8 –∏–Ω—Ü–µ–ª—å–Ω–æ—Å—Ç–∏ | üò¥ +6 | (25% —à–∞–Ω—Å: üì∏ —Å—Ñ–æ—Ç–∫–∞—Ç—å –ø–µ–Ω–∏—Å)"><span class="action-icon">üöø</span>–ü–æ–º—ã—Ç—å—Å—è</button>
                <button class="action-btn" onclick="shave()" data-tooltip="üß† +7 –∞–¥–µ–∫–≤–∞—Ç–Ω–æ—Å—Ç–∏ | üîª -7 –∏–Ω—Ü–µ–ª—å–Ω–æ—Å—Ç–∏ | üò¥ +4 | (35% —à–∞–Ω—Å: ü§≥ —Å–µ–ª—Ñ–∏)"><span class="action-icon">ü™í</span>–ü–æ–±—Ä–∏—Ç—å—Å—è</button>
                <button class="action-btn" onclick="goOutside()" data-tooltip="üß† +8 –∞–¥–µ–∫–≤–∞—Ç–Ω–æ—Å—Ç–∏ | üò¥ +18 —É—Å—Ç–∞–ª–æ—Å—Ç–∏ | üòä +3 –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è" id="goOutsideBtn"><span class="action-icon">üö™</span>–í—ã–π—Ç–∏ –∏–∑ –¥–æ–º–∞</button>
                <button class="action-btn" onclick="askParentsFood()" id="askFoodBtn" data-tooltip="üçî +35 —Å—ã—Ç–æ—Å—Ç–∏ | üòä -8 –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è | –õ–∏–º–∏—Ç: 3 —Ä–∞–∑–∞ –≤ –¥–µ–Ω—å"><span class="action-icon">üè†</span>–ü–æ–ø—Ä–æ—Å–∏—Ç—å –µ–¥—É —É —Ä–æ–¥–∏—Ç–µ–ª–µ–π</button>
                <button class="action-btn" onclick="eatTrash()" data-tooltip="üçî +25 —Å—ã—Ç–æ—Å—Ç–∏ | üìà +15 –∏–Ω—Ü–µ–ª—å–Ω–æ—Å—Ç–∏ | ‚ù§Ô∏è -8 –∑–¥–æ—Ä–æ–≤—å—è | üß† -5 –∞–¥–µ–∫–≤–∞—Ç–Ω–æ—Å—Ç–∏"><span class="action-icon">üóëÔ∏è</span>–ü–æ–µ—Å—Ç—å –∏–∑ –ø–æ–º–æ–π–∫–∏</button>
                <button class="action-btn" onclick="callVika()" id="callVikaBtn" data-tooltip="üí∞ -10000‚ÇΩ | üß† —Ç—Ä–µ–±—É–µ—Ç 35+ –∞–¥–µ–∫–≤–∞—Ç–Ω–æ—Å—Ç–∏ | üò¥ +20 | –®–∞–Ω—Å —É—Å–ø–µ—Ö–∞: 75%"><span class="action-icon">üìû</span>–ü–æ–∑–≤–æ–Ω–∏—Ç—å –í–∏–∫–µ</button>
                <button class="action-btn" onclick="postAyaech()" data-tooltip="üòä +8 –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è | üìà +8 –∏–Ω—Ü–µ–ª—å–Ω–æ—Å—Ç–∏ | üò¥ +12 —É—Å—Ç–∞–ª–æ—Å—Ç–∏" id="postBtn"><span class="action-icon">üì±</span>–ü–æ—Å—Ç–∏—Ç—å –≤ –ê–Ø–ï–ß</button>
                <button class="action-btn" onclick="masturbate()" id="masturbate-btn" data-tooltip="üòä +8 –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è | ‚ù§Ô∏è +2 –∑–¥–æ—Ä–æ–≤—å—è | üìà +10 –∏–Ω—Ü–µ–ª—å–Ω–æ—Å—Ç–∏ | üß† -10 –∞–¥–µ–∫–≤–∞—Ç–Ω–æ—Å—Ç–∏ | üò¥ +7 —É—Å—Ç–∞–ª–æ—Å—Ç–∏ | –ë–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ —É—Å—Ç–∞–ª–æ—Å—Ç–∏ ‚â•80"><span class="action-icon">üôà</span>–î—Ä–æ—á–∫–∞</button>
                <button class="action-btn" onclick="orderMamba()" id="mambaBtn" data-tooltip="üí∞ -8000‚ÇΩ | üòä +35 –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è | ‚ù§Ô∏è -18 –∑–¥–æ—Ä–æ–≤—å—è | üò¥ +10 —É—Å—Ç–∞–ª–æ—Å—Ç–∏"><span class="action-icon">üíä</span>–ó–∞–∫–∞–∑–∞—Ç—å –ú–∞–º–±—É</button>
                <button class="action-btn" onclick="goToHospital()" id="hospitalBtn" data-tooltip="‚ù§Ô∏è +25 –∑–¥–æ—Ä–æ–≤—å—è | üí∞ -2000‚ÇΩ | üò¥ +15 | üòä -10 | üß† +5 | 1 —Ä–∞–∑/–¥–µ–Ω—å"><span class="action-icon">üè•</span>–°—Ö–æ–¥–∏—Ç—å –≤ –±–æ–ª—å–Ω–∏—Ü—É</button>
                <button class="action-btn" onclick="rideMetro()" id="metroBtn" data-tooltip="üëë -25 –∫–æ–º–ø–ª–µ–∫—Å–∞ –±–æ–≥–∞ | üìà +18 –∏–Ω—Ü–µ–ª—å–Ω–æ—Å—Ç–∏ | üò¥ +15 | üí∞ -50‚ÇΩ | üòä +3 | üß† -3"><span class="action-icon">üöá</span>–ú–µ—Ç—Ä–æ</button>
                <button class="action-btn primary" onclick="sleep()" data-tooltip="–ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –¥–Ω—é | üò¥ —É—Å—Ç–∞–ª–æ—Å—Ç—å /2 | ‚ö†Ô∏è –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–ª–≥–æ–≤ –∏ –¥–µ–ø—Ä–µ—Å—Å–∏–∏"><span class="action-icon">üò¥</span>–°–ø–∞—Ç—å (—Å–ª–µ–¥. –¥–µ–Ω—å)</button>
            </div>
        </div>

        <div class="achievements">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h2>üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h2>
                <div>
                    <button class="action-btn" onclick="showAchievements()" style="padding: 8px 16px; margin-right: 10px; background: var(--color-warning); color: #000;">üèÜ –í—Å–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è</button>
                    <button class="action-btn" onclick="showStatistics()" style="padding: 8px 16px; background: var(--color-success); color: #000;">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
                </div>
            </div>
            <div id="achievementsList">
                <div class="achievement locked">üéñÔ∏è –ù–µ–¥–µ–ª—è (7 –¥–Ω–µ–π)</div>
                <div class="achievement locked">üéñÔ∏è –î–≤–µ –Ω–µ–¥–µ–ª–∏ (14)</div>
                <div class="achievement locked">üéñÔ∏è –¢—Ä–∏ –Ω–µ–¥–µ–ª–∏ (21)</div>
            </div>
        </div>
    </div>

    <div class="game-over-modal" id="gameOverModal">
        <div class="game-over-content">
            <h2>üíÄ GAME OVER</h2>
            <p id="gameOverReason" style="font-size: 1.2em; margin: 20px 0;"></p>
            <p>–î–Ω–µ–π –ø—Ä–æ–∂–∏—Ç–æ: <strong id="finalDays">0</strong></p>
            <button class="restart-btn" onclick="restartGame()">üîÑ –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
        </div>
    </div>

    <!-- Tutorial Modal -->
    <div class="game-over-modal" id="tutorialModal" style="display: flex;">
        <div class="game-over-content" style="max-width: 700px; max-height: 90vh; overflow-y: auto; border-color: var(--color-primary);">
            <h2 style="color: var(--color-primary);">üéÆ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∂–∏–∑–Ω—å –ú–∞—Ç–≤–µ—è!</h2>
            <p style="margin: 15px 0; text-align: left;">
                –¢—ã - –ú–∞—Ç–≤–µ–π, 25-–ª–µ—Ç–Ω–∏–π –∏–Ω—Ü–µ–ª –∏–∑ –ü–∏—Ç–µ—Ä–∞. –¢–≤–æ—è —Ü–µ–ª—å - –≤—ã–∂–∏—Ç—å –∫–∞–∫ –º–æ–∂–Ω–æ –¥–æ–ª—å—à–µ.
            </p>
            <h3 style="color: var(--color-warning); margin-top: 20px;">üìä –ü–ê–†–ê–ú–ï–¢–†–´:</h3>
            <div style="text-align: left; margin: 15px 0; line-height: 1.8;">
                <p><strong>‚ù§Ô∏è –ó–î–û–†–û–í–¨–ï (0-100)</strong><br>
                –§–∏–∑–∏—á–µ—Å–∫–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ. –ü—Ä–∏ 0 - —Å–º–µ—Ä—Ç—å.<br>
                <span style="color: #44ff44;">‚Üë –ü–æ–≤—ã—à–∞–µ—Ç—Å—è:</span> –¥—Ä–æ—á–∫–∞, –±–æ–ª—å–Ω–∏—Ü–∞<br>
                <span style="color: #ff4444;">‚Üì –ü–æ–Ω–∏–∂–∞–µ—Ç—Å—è:</span> —Ä–∞–±–æ—Ç–∞, –ú–∞–º–±–∞, –≥–æ–ø–Ω–∏–∫–∏, –ø–æ–º–æ–π–∫–∞</p>

                <p><strong>üòä –ù–ê–°–¢–†–û–ï–ù–ò–ï (0-100)</strong><br>
                –ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ. –ü—Ä–∏ &lt;20 —Ç—Ä–∏ –¥–Ω—è –ø–æ–¥—Ä—è–¥ - —Ä–∏—Å–∫ —Å—É–∏—Ü–∏–¥–∞.<br>
                <span style="color: #44ff44;">‚Üë –ü–æ–≤—ã—à–∞–µ—Ç—Å—è:</span> –¥—Ä–æ—á–∫–∞, –ú–∞–º–±–∞, –ø–æ—Å—Ç–∏–Ω–≥, –í–∏–∫–∞<br>
                <span style="color: #ff4444;">‚Üì –ü–æ–Ω–∏–∂–∞–µ—Ç—Å—è:</span> —Ä–∞–±–æ—Ç–∞, –ø—Ä–æ—Å–∏—Ç—å –µ–¥—É, –±–æ–ª—å–Ω–∏—Ü–∞</p>

                <p><strong>üçî –°–´–¢–û–°–¢–¨ (0-100)</strong><br>
                –ì–æ–ª–æ–¥. –ü—Ä–∏ 0 –±–æ–ª–µ–µ 3 –¥–Ω–µ–π - —Å–º–µ—Ä—Ç—å –æ—Ç –≥–æ–ª–æ–¥–∞.<br>
                <span style="color: #44ff44;">‚Üë –ü–æ–≤—ã—à–∞–µ—Ç—Å—è:</span> –µ–¥–∞ –æ—Ç —Ä–æ–¥–∏—Ç–µ–ª–µ–π, –ø–æ–º–æ–π–∫–∞<br>
                <span style="color: #ff4444;">‚Üì –ü–æ–Ω–∏–∂–∞–µ—Ç—Å—è:</span> –∫–∞–∂–¥—ã–π –¥–µ–Ω—å -25</p>

                <p><strong>üß† –ê–î–ï–ö–í–ê–¢–ù–û–°–¢–¨ (0-100)</strong><br>
                –ù–∞—Å–∫–æ–ª—å–∫–æ —Ç—ã –≤–º–µ–Ω—è–µ–º. –í–ª–∏—è–µ—Ç –Ω–∞ —à–∞–Ω—Å —Å –í–∏–∫–æ–π.<br>
                <span style="color: #44ff44;">‚Üë –ü–æ–≤—ã—à–∞–µ—Ç—Å—è:</span> –≥–∏–≥–∏–µ–Ω–∞, –≤—ã—Ö–æ–¥ –∏–∑ –¥–æ–º–∞, –±–æ–ª—å–Ω–∏—Ü–∞<br>
                <span style="color: #ff4444;">‚Üì –ü–æ–Ω–∏–∂–∞–µ—Ç—Å—è:</span> –¥—Ä–æ—á–∫–∞, –ø–æ–º–æ–π–∫–∞, –ø–æ—Å—Ç–∏–Ω–≥</p>

                <p><strong>ü§° –ò–ù–¶–ï–õ–¨–ù–û–°–¢–¨ (0-100)</strong><br>
                –£—Ä–æ–≤–µ–Ω—å –¥–µ–≥—Ä–∞–¥–∞—Ü–∏–∏. –ü—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω–∞ –∞–¥–µ–∫–≤–∞—Ç–Ω–æ—Å—Ç–∏, –≤–ª–∏—è–µ—Ç –Ω–∞ –í–∏–∫—É.<br>
                <span style="color: #ff4444;">‚Üë –ü–æ–≤—ã—à–∞–µ—Ç—Å—è:</span> –¥—Ä–æ—á–∫–∞, –ø–æ–º–æ–π–∫–∞, –ø–æ—Å—Ç–∏–Ω–≥, –≥–æ–ø–Ω–∏–∫–∏<br>
                <span style="color: #44ff44;">‚Üì –ü–æ–Ω–∏–∂–∞–µ—Ç—Å—è:</span> –≥–∏–≥–∏–µ–Ω–∞, –≤—ã—Ö–æ–¥ –∏–∑ –¥–æ–º–∞</p>

                <p><strong>üëë –ö–û–ú–ü–õ–ï–ö–° –ë–û–ì–ê (0-100)</strong><br>
                –†–∞–∑–¥—É—Ç–æ–µ –≠–ì–û. –ü—Ä–∏ &gt;50 <strong>–±–ª–æ–∫–∏—Ä—É–µ—Ç</strong> –≥–∏–≥–∏–µ–Ω—É –∏ –≤—ã—Ö–æ–¥ –∏–∑ –¥–æ–º–∞. –ü—Ä–∏ 100 - game over.<br>
                <span style="color: #ff4444;">‚Üë –ü–æ–≤—ã—à–∞–µ—Ç—Å—è:</span> —Ñ–æ—Ç–∫–∞ –ø–µ–Ω–∏—Å–∞, —É—Å–ø–µ—à–Ω—ã–π –∑–≤–æ–Ω–æ–∫ –í–∏–∫–µ<br>
                <span style="color: #44ff44;">‚Üì –ü–æ–Ω–∏–∂–∞–µ—Ç—Å—è:</span> –Ω–µ—É–¥–∞—á–Ω—ã–π –∑–≤–æ–Ω–æ–∫ –í–∏–∫–µ, –≥–æ–ø–Ω–∏–∫–∏</p>

                <p><strong>üò¥ –£–°–¢–ê–õ–û–°–¢–¨ (0-100)</strong><br>
                –£—Ç–æ–º–ª–µ–Ω–∏–µ. –ü—Ä–∏ &gt;80 –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É, –ø—Ä–æ–≥—É–ª–∫–∏, –ø–æ—Å—Ç–∏–Ω–≥.<br>
                <span style="color: #ff4444;">‚Üë –ü–æ–≤—ã—à–∞–µ—Ç—Å—è:</span> –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è<br>
                <span style="color: #44ff44;">‚Üì –ü–æ–Ω–∏–∂–∞–µ—Ç—Å—è:</span> —Å–æ–Ω (–≤–¥–≤–æ–µ)</p>

                <p><strong>üí∞ –î–ï–ù–¨–ì–ò</strong><br>
                –ù—É–∂–Ω—ã –¥–ª—è –í–∏–∫–∏ (10,000‚ÇΩ), –ú–∞–º–±—ã (8,000‚ÇΩ), –±–æ–ª—å–Ω–∏—Ü—ã (2,000‚ÇΩ), –ñ–ö–• (5,000‚ÇΩ –∫–∞–∂–¥—ã–µ 7 –¥–Ω–µ–π).<br>
                <span style="color: #44ff44;">‚ö° –†–∞–±–æ—Ç–∞:</span> –í—ã–±–∏—Ä–∞–π –º–µ–∂–¥—É –∞—Å—Ñ–∞–ª—å—Ç–æ–º (—Ç—è–∂–µ–ª–æ, 2200-3800‚ÇΩ) –∏ –¥–æ—Å—Ç–∞–≤–∫–æ–π (–ª–µ–≥—á–µ, 800-1500‚ÇΩ).<br>
                <span style="color: #ff4444;">‚ö†Ô∏è –í–ê–ñ–ù–û:</span> –ï—Å–ª–∏ —É —Ç–µ–±—è –Ω–µ—Ç –¥–µ–Ω–µ–≥, –≥–æ–ø–Ω–∏–∫–∏ –±—å—é—Ç —Å–∏–ª—å–Ω–µ–µ!</p>

                <p><strong>üíñ –û–¢–ù–û–®–ï–ù–ò–Ø –° –í–ò–ö–û–ô (0-100)</strong><br>
                –ù–æ–≤—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä –≤–ª–∏—è–µ—Ç –Ω–∞ –∏—Ç–æ–≥–æ–≤—É—é –∫–æ–Ω—Ü–æ–≤–∫—É.<br>
                <span style="color: #44ff44;">‚Üë –ü–æ–≤—ã—à–∞–µ—Ç—Å—è:</span> —É—Å–ø–µ—à–Ω—ã–µ –∑–≤–æ–Ω–∫–∏ +10, –≤—Å—Ç—Ä–µ—á–∞ +20<br>
                <span style="color: #ff4444;">‚Üì –ü–æ–Ω–∏–∂–∞–µ—Ç—Å—è:</span> –Ω–µ—É–¥–∞—á–Ω—ã–µ –∑–≤–æ–Ω–∫–∏ -15, –¥–µ–ø—Ä–µ—Å—Å–∏—è -10/–¥–µ–Ω—å<br>
                –ü—Ä–∏ 100/100 - —Ñ–∏–Ω–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ü–æ–≤–∫–∞ —Å –í–∏–∫–æ–π!</p>
            </div>
            <h3 style="color: var(--color-danger); margin-top: 20px;">‚ö†Ô∏è GAME OVER –ø—Ä–∏:</h3>
            <ul style="text-align: left; line-height: 1.8;">
                <li>–ó–¥–æ—Ä–æ–≤—å–µ = 0</li>
                <li>–ì–æ–ª–æ–¥ 3+ –¥–Ω—è</li>
                <li>–ö–æ–º–ø–ª–µ–∫—Å –±–æ–≥–∞ = 100</li>
                <li>–£—Å–ø–µ—à–Ω—ã–π —Å—É–∏—Ü–∏–¥ (–ø—Ä–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–∏ &lt;20 —Ç—Ä–∏ –¥–Ω—è –ø–æ–¥—Ä—è–¥)</li>
                <li><strong>–î–æ–ª–≥ 7+ –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥</strong></li>
            </ul>
            <p style="margin-top: 20px; font-weight: bold;">–£–¥–∞—á–∏ –≤ –≤—ã–∂–∏–≤–∞–Ω–∏–∏!</p>
            <button class="restart-btn" onclick="closeTutorial()">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
        </div>
    </div>

    <!-- Work Choice Modal -->
    <div class="game-over-modal" id="workChoiceModal">
        <div class="game-over-content" style="max-width: 700px; border-color: var(--color-warning);">
            <h2 style="color: var(--color-warning);">üíº –í—ã–±–æ—Ä —Ä–∞–±–æ—Ç—ã</h2>
            <p style="margin: 15px 0;">–ú–∞—Ç–≤–µ–π –º–æ–∂–µ—Ç –ø–æ–¥—Ä–∞–±–æ—Ç–∞—Ç—å. –í—ã–±–µ—Ä–∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏—é:</p>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                <div style="background: #1a1a1a; padding: 20px; border-radius: 10px; border: 2px solid #666; cursor: pointer;" onclick="chooseWork('asphalt')" class="work-choice-card">
                    <h3 style="color: #ffaa00; margin-bottom: 10px;">üöß –£–∫–ª–∞–¥—á–∏–∫ –∞—Å—Ñ–∞–ª—å—Ç–∞</h3>
                    <div style="text-align: left; line-height: 1.8; font-size: 0.9em;">
                        <p><strong>üí∞ –î–µ–Ω—å–≥–∏:</strong> 2200-3800‚ÇΩ</p>
                        <p><strong>‚ù§Ô∏è –ó–¥–æ—Ä–æ–≤—å–µ:</strong> -15</p>
                        <p><strong>üò¥ –£—Å—Ç–∞–ª–æ—Å—Ç—å:</strong> +25</p>
                        <p><strong>üòä –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ:</strong> -8</p>
                        <p><strong>ü§° –ò–Ω—Ü–µ–ª—å–Ω–æ—Å—Ç—å:</strong> +8</p>
                        <p><strong>üß† –ê–¥–µ–∫–≤–∞—Ç–Ω–æ—Å—Ç—å:</strong> +3</p>
                        <hr style="border: 1px solid #333; margin: 10px 0;">
                        <p style="font-size: 0.85em; color: #aaa;"><strong>–°–æ–±—ã—Ç–∏—è:</strong><br>
                        ‚Ä¢ –°–∫–∞–Ω–¥–∞–ª —Å –∫–æ–ª–ª–µ–≥–∞–º–∏ (12%)<br>
                        ‚Ä¢ –ù–∞—á–∞–ª—å–Ω–∏–∫ –ø–æ—Ö–≤–∞–ª–∏–ª (6%)<br>
                        ‚Ä¢ –®—Ç—Ä–∞—Ñ –∑–∞ –±—Ä–∞–∫ (8%)</p>
                    </div>
                </div>
                
                <div style="background: #1a1a1a; padding: 20px; border-radius: 10px; border: 2px solid #666; cursor: pointer;" onclick="chooseWork('delivery')" class="work-choice-card">
                    <h3 style="color: #4a9eff; margin-bottom: 10px;">üö¥ –î–æ—Å—Ç–∞–≤—â–∏–∫ –µ–¥—ã</h3>
                    <div style="text-align: left; line-height: 1.8; font-size: 0.9em;">
                        <p><strong>üí∞ –î–µ–Ω—å–≥–∏:</strong> 800-1500‚ÇΩ</p>
                        <p><strong>‚ù§Ô∏è –ó–¥–æ—Ä–æ–≤—å–µ:</strong> -8</p>
                        <p><strong>üò¥ –£—Å—Ç–∞–ª–æ—Å—Ç—å:</strong> +15</p>
                        <p><strong>üòä –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ:</strong> -3</p>
                        <p><strong>ü§° –ò–Ω—Ü–µ–ª—å–Ω–æ—Å—Ç—å:</strong> +4</p>
                        <p><strong>üß† –ê–¥–µ–∫–≤–∞—Ç–Ω–æ—Å—Ç—å:</strong> +6</p>
                        <hr style="border: 1px solid #333; margin: 10px 0;">
                        <p style="font-size: 0.85em; color: #aaa;"><strong>–°–æ–±—ã—Ç–∏—è:</strong><br>
                        ‚Ä¢ –ß–∞–µ–≤—ã–µ –∫–ª–∏–µ–Ω—Ç–∞ (15%)<br>
                        ‚Ä¢ –ü–æ–ø–∞–ª –ø–æ–¥ –¥–æ–∂–¥—å (6%)<br>
                        ‚Ä¢ –ù–∞–≥–ª–∞—è —Å–æ–±–∞–∫–∞ (7%)</p>
                    </div>
                </div>
            </div>
            
            <button class="restart-btn" onclick="closeWorkChoice()" style="background: var(--color-secondary); color: var(--color-text); margin-top: 10px;">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>

    <!-- Achievements Modal -->
    <div class="game-over-modal" id="achievementsModal">
        <div class="game-over-content" style="max-width: 800px; max-height: 90vh; overflow-y: auto; border-color: var(--color-warning);">
            <h2 style="color: var(--color-warning);">üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h2>
            <div id="achievementsFullList" style="text-align: left; margin: 20px 0;"></div>
            <button class="restart-btn" onclick="closeAchievements()" style="background: var(--color-secondary); color: var(--color-text);">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>

    <!-- Welcome Toast -->
    <div id="welcome-toast" class="toast hidden">
        <div class="toast-content">
            <div class="toast-icon">üéÆ</div>
            <div class="toast-text">
                <strong>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, –ú–∞—Ç–≤–µ–π!</strong><br>
                –î–µ–Ω—å 1. –¢–≤–æ—è –∂–∏–∑–Ω—å –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å–µ–π—á–∞—Å. –£–¥–∞—á–∏ –≤ –≤—ã–∂–∏–≤–∞–Ω–∏–∏!
            </div>
        </div>
    </div>

    <!-- Statistics Modal -->
    <div class="game-over-modal" id="statisticsModal">
        <div class="game-over-content" style="max-width: 600px; max-height: 90vh; overflow-y: auto; border-color: var(--color-success);">
            <h2 style="color: var(--color-success);">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
            <div id="statisticsContent" style="text-align: left; margin: 20px 0; line-height: 2;"></div>
            <button class="restart-btn" onclick="closeStatistics()" style="background: var(--color-secondary); color: var(--color-text);">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>

    <script>
        // ============================================
        // TELEGRAM WEB APP INTEGRATION
        // ============================================
        let tg = null;
        let isTelegram = false;

        // Initialize Telegram Web App
        function initTelegram() {
            if (window.Telegram && window.Telegram.WebApp) {
                tg = window.Telegram.WebApp;
                isTelegram = true;
                
                console.log('üöÄ Telegram Web App initialized');
                
                // Configure interface
                tg.ready();
                tg.expand(); // Expand to full screen
                
                // Set theme colors
                tg.setHeaderColor('#1a1a1a');
                tg.setBackgroundColor('#1a1a1a');
                
                // Enable closing confirmation
                tg.enableClosingConfirmation();
                
                // Configure Main Button
                tg.MainButton.setText('üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–≥—Ä—É');
                tg.MainButton.color = '#4a9eff';
                tg.MainButton.textColor = '#ffffff';
                tg.MainButton.show();
                
                tg.MainButton.onClick(() => {
                    saveGame();
                    if (tg.HapticFeedback) {
                        tg.HapticFeedback.notificationOccurred('success');
                    }
                    tg.showAlert('‚úÖ –ò–≥—Ä–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ Telegram Cloud!');
                });
                
                // Apply Telegram theme
                document.body.classList.add('telegram');
                if (tg.themeParams) {
                    document.documentElement.style.setProperty('--color-bg', tg.themeParams.bg_color || '#1a1a1a');
                    document.documentElement.style.setProperty('--color-text', tg.themeParams.text_color || '#e0e0e0');
                    document.documentElement.style.setProperty('--color-primary', tg.themeParams.button_color || '#4a9eff');
                }
                
                // Get user info
                const user = tg.initDataUnsafe?.user;
                if (user) {
                    console.log('üë§ Telegram User:', user.first_name, user.id);
                }
                
                return true;
            }
            return false;
        }

        // Haptic feedback wrapper
        function hapticFeedback(type = 'light') {
            if (isTelegram && tg && tg.HapticFeedback) {
                if (type === 'light') {
                    tg.HapticFeedback.impactOccurred('light');
                } else if (type === 'medium') {
                    tg.HapticFeedback.impactOccurred('medium');
                } else if (type === 'heavy') {
                    tg.HapticFeedback.impactOccurred('heavy');
                } else if (type === 'success') {
                    tg.HapticFeedback.notificationOccurred('success');
                } else if (type === 'warning') {
                    tg.HapticFeedback.notificationOccurred('warning');
                } else if (type === 'error') {
                    tg.HapticFeedback.notificationOccurred('error');
                }
            }
        }

        // Telegram Cloud Storage save
        function saveGame() {
            const saveData = JSON.stringify(gameState);
            
            if (isTelegram && tg && tg.CloudStorage) {
                tg.CloudStorage.setItem('matvey_save', saveData, (error, result) => {
                    if (error) {
                        console.error('‚ùå Telegram Cloud save error:', error);
                    } else {
                        console.log('‚òÅÔ∏è Game saved to Telegram Cloud');
                    }
                });
            } else {
                // Browser mode - use in-memory only (storage blocked in sandbox)
                console.log('üíæ Game saved to memory (browser mode)');
            }
        }

        // Throttled save
        let saveTimeout = null;
        function saveGameThrottled() {
            if (saveTimeout) {
                clearTimeout(saveTimeout);
            }
            saveTimeout = setTimeout(() => {
                saveGame();
            }, 1000);
        }

        // Load game from Telegram Cloud
        function loadGameFromTelegram() {
            if (isTelegram && tg && tg.CloudStorage) {
                tg.CloudStorage.getItem('matvey_save', (error, data) => {
                    if (!error && data) {
                        try {
                            gameState = JSON.parse(data);
                            console.log('‚òÅÔ∏è Game loaded from Telegram Cloud');
                            updateUI();
                            updateAchievementsDisplay();
                            addLog('<strong>‚òÅÔ∏è –ü—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–≥—Ä—É–∂–µ–Ω</strong><br>–ò–≥—Ä–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –∏–∑ Telegram Cloud!', 'event');
                        } catch (e) {
                            console.error('‚ùå Parse error:', e);
                            initializeNewGame();
                        }
                    } else {
                        console.log('üìù No save found - new game');
                        initializeNewGame();
                    }
                    updateUI();
                });
            } else {
                console.log('üéÆ Browser mode - starting new game');
                initializeNewGame();
                updateUI();
            }
        }

        function initializeNewGame() {
            // gameState already initialized below
            console.log('üéÆ New game initialized');
        }

        // Share achievement
        function shareAchievement() {
            if (isTelegram && tg) {
                const message = `üéÆ –Ø –≤—ã–∂–∏–ª ${gameState.day} –¥–Ω–µ–π –≤ "–°–∏–º—É–ª—è—Ç–æ—Ä–µ –ú–∞—Ç–≤–µ—è"!\n` +
                               `üí∞ –ó–∞—Ä–∞–±–æ—Ç–∞–ª: ${gameState.stats.totalMoneyEarned.toLocaleString('ru-RU')}‚ÇΩ\n` +
                               `üíñ –û—Ç–Ω–æ—à–µ–Ω–∏—è —Å –í–∏–∫–æ–π: ${Math.round(gameState.vikaRelationship)}/100\n\n` +
                               `–°–º–æ–∂–µ—à—å –ª–∏ —Ç—ã –ø–µ—Ä–µ–∂–∏—Ç—å –∂–∏–∑–Ω—å –ú–∞—Ç–≤–µ—è?`;
                
                tg.switchInlineQuery(message, ['users', 'groups', 'channels']);
            }
        }

        // ============================================
        // GAME STATE
        // ============================================
        let gameState = {
            health: 100,
            mood: 50,
            satiety: 100,
            adequacy: 20,
            incel: 80,
            godComplex: 40,
            fatigue: 0,
            money: 25000,
            day: 1,
            vikaRelationship: 0,
            parentFoodToday: 0,
            satietyZeroDays: 0,
            daysInDepression: 0,
            daysInDebt: 0,
            hospitalToday: false,
            achievements: [],
            // Statistics tracking
            stats: {
                totalMoneyEarned: 0,
                workShifts: 0,
                vikaCallsSuccess: 0,
                vikaCallsFail: 0,
                vikaMoneySpent: 0,
                postsCount: 0,
                trashMeals: 0,
                dickPics: 0,
                hospitalVisits: 0,
                washCount: 0,
                shaveCount: 0,
                outsideCount: 0,
                daysWithoutOutside: 0,
                suicideAttempts: 0,
                metroRides: 0,
                metroFined: 0
            }
        };

        // Tutorial auto-close flag
        let tutorialClosed = false;

        // Setup action buttons to close tutorial on first click
        function setupTutorialAutoClose() {
            const actionButtons = document.querySelectorAll('.action-btn');
            actionButtons.forEach(btn => {
                const originalOnClick = btn.getAttribute('onclick');
                if (originalOnClick) {
                    btn.addEventListener('click', () => {
                        if (!tutorialClosed) {
                            closeTutorial();
                        }
                    }, { once: false });
                }
            });
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
        function updateUI() {
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–æ–≤
            document.getElementById('healthValue').textContent = Math.round(gameState.health);
            
            // Display mood (range: 0 to 100)
            const moodValue = Math.round(gameState.mood);
            let moodText = moodValue + '/100';
            if (gameState.mood < 20) {
                if (gameState.daysInDepression === 0) {
                    moodText += ' ‚ö†Ô∏è –í –¥–µ–ø—Ä–µ—Å—Å–∏–∏';
                } else if (gameState.daysInDepression === 1) {
                    moodText += ' ‚ö†Ô∏è –î–µ–ø—Ä–µ—Å—Å–∏—è: 1/3';
                } else if (gameState.daysInDepression === 2) {
                    moodText += ' ‚ö†Ô∏è –û–ü–ê–°–ù–û! 2/3';
                }
            }
            document.getElementById('moodValue').textContent = moodText;
            document.getElementById('satietyValue').textContent = Math.round(gameState.satiety);
            document.getElementById('adequacyValue').textContent = Math.round(gameState.adequacy);
            document.getElementById('incelValue').textContent = Math.round(gameState.incel);
            document.getElementById('godComplexValue').textContent = Math.round(gameState.godComplex);
            document.getElementById('fatigueValue').textContent = Math.round(gameState.fatigue);
            // Update money display with debt indication
            const moneyDisplay = document.getElementById('moneyDisplay');
            const moneyValue = document.getElementById('moneyValue');
            const debtCounter = document.getElementById('debtCounter');
            const debtDays = document.getElementById('debtDays');
            
            if (gameState.money < 0) {
                moneyDisplay.classList.add('debt');
                moneyValue.textContent = gameState.money.toLocaleString('ru-RU');
                moneyValue.innerHTML = gameState.money.toLocaleString('ru-RU') + ' ‚ö†Ô∏è –î–û–õ–ì!';
                debtCounter.style.display = 'block';
                debtDays.textContent = gameState.daysInDebt;
                if (gameState.daysInDebt >= 6) {
                    debtCounter.classList.add('critical');
                } else {
                    debtCounter.classList.remove('critical');
                }
            } else {
                moneyDisplay.classList.remove('debt');
                moneyValue.textContent = gameState.money.toLocaleString('ru-RU');
                debtCounter.style.display = 'none';
            }
            document.getElementById('dayCounter').textContent = gameState.day;
            document.getElementById('vikaRelationshipValue').textContent = Math.round(gameState.vikaRelationship) + '/100';
            document.getElementById('vikaRelationshipBar').style.width = gameState.vikaRelationship + '%';

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–æ–≤
            document.getElementById('healthBar').style.width = gameState.health + '%';
            
            // Mood bar: 0-100 range
            const moodBar = document.getElementById('moodBar');
            moodBar.style.width = gameState.mood + '%';
            
            // Update mood bar color based on mood value
            if (gameState.mood < 20) {
                moodBar.className = 'progress-fill progress-mood-red';
            } else if (gameState.mood <= 40) {
                moodBar.className = 'progress-fill progress-mood-orange';
            } else if (gameState.mood <= 70) {
                moodBar.className = 'progress-fill progress-mood-yellow';
            } else {
                moodBar.className = 'progress-fill progress-mood-green';
            }
            document.getElementById('satietyBar').style.width = gameState.satiety + '%';
            document.getElementById('adequacyBar').style.width = gameState.adequacy + '%';
            document.getElementById('incelBar').style.width = gameState.incel + '%';
            document.getElementById('godComplexBar').style.width = gameState.godComplex + '%';
            
            // Update fatigue bar with color based on level
            const fatigueBar = document.getElementById('fatigueBar');
            fatigueBar.style.width = gameState.fatigue + '%';
            if (gameState.fatigue <= 30) {
                fatigueBar.className = 'progress-fill progress-fatigue-low';
            } else if (gameState.fatigue <= 60) {
                fatigueBar.className = 'progress-fill progress-fatigue-medium';
            } else {
                fatigueBar.className = 'progress-fill progress-fatigue-high';
            }

            // –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∑–Ω–∞—á–µ–Ω–∏—è—Ö
            updateStatAlerts();
            updateActionButtons();
        }

        function updateStatAlerts() {
            const healthValue = document.getElementById('healthValue');
            const satietyValue = document.getElementById('satietyValue');
            const godComplexValue = document.getElementById('godComplexValue');
            const moodValue = document.getElementById('moodValue');

            healthValue.className = gameState.health <= 20 ? 'stat-value stat-alert' : 'stat-value';
            satietyValue.className = gameState.satiety <= 20 ? 'stat-value stat-alert' : 'stat-value';
            godComplexValue.className = gameState.godComplex >= 70 ? 'stat-value stat-alert' : 'stat-value';
            moodValue.className = gameState.mood < 20 ? 'stat-value stat-alert' : 'stat-value';
            
            const adequacyValue = document.getElementById('adequacyValue');
            adequacyValue.className = gameState.adequacy < 20 ? 'stat-value stat-alert' : 'stat-value';
            
            const fatigueValue = document.getElementById('fatigueValue');
            fatigueValue.className = gameState.fatigue >= 80 ? 'stat-value stat-alert' : 'stat-value';
        }

        function updateActionButtons() {
            // –ö–Ω–æ–ø–∫–∞ —Ä–∞–±–æ—Ç—ã
            const workBtn = document.querySelector('[onclick="work()"]');
            if (gameState.fatigue >= 80) {
                workBtn.disabled = true;
                workBtn.setAttribute('data-tooltip', '‚ùå –°–ª–∏—à–∫–æ–º —É—Å—Ç–∞–ª –¥–ª—è —Ä–∞–±–æ—Ç—ã (—É—Å—Ç–∞–ª–æ—Å—Ç—å ' + Math.round(gameState.fatigue) + '/100)');
            } else if (gameState.godComplex > 50) {
                workBtn.disabled = true;
                workBtn.setAttribute('data-tooltip', '‚ùå –Ø —Å–ª–∏—à–∫–æ–º –∫—Ä—É—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã (–∫–æ–º–ø–ª–µ–∫—Å –±–æ–≥–∞ ' + Math.round(gameState.godComplex) + '/100)');
            } else {
                workBtn.disabled = false;
                workBtn.setAttribute('data-tooltip', '–í—ã–±–µ—Ä–∏: –ê—Å—Ñ–∞–ª—å—Ç (—Ç—è–∂–µ–ª–æ, 2200-3800‚ÇΩ) –∏–ª–∏ –î–æ—Å—Ç–∞–≤–∫–∞ (–ª–µ–≥—á–µ, 800-1500‚ÇΩ)');
            }
            
            // –ö–Ω–æ–ø–∫–∏, –±–ª–æ–∫–∏—Ä—É–µ–º—ã–µ –∫–æ–º–ø–ª–µ–∫—Å–æ–º –±–æ–≥–∞
            const washBtn = document.querySelector('[onclick="wash()"]');
            const shaveBtn = document.querySelector('[onclick="shave()"]');
            const goOutsideBtn = document.getElementById('goOutsideBtn');
            
            // –ö–Ω–æ–ø–∫–∞ –º—ã—Ç—å—è
            if (gameState.godComplex > 50) {
                washBtn.disabled = true;
                washBtn.setAttribute('data-tooltip', '‚ùå –Ø —Å–ª–∏—à–∫–æ–º –∫—Ä—É—Ç, —á—Ç–æ–±—ã –º—ã—Ç—å—Å—è (–∫–æ–º–ø–ª–µ–∫—Å –±–æ–≥–∞ ' + Math.round(gameState.godComplex) + '/100)');
            } else {
                washBtn.disabled = false;
                washBtn.setAttribute('data-tooltip', 'üß† +8 –∞–¥–µ–∫–≤–∞—Ç–Ω–æ—Å—Ç–∏ | üîª -8 –∏–Ω—Ü–µ–ª—å–Ω–æ—Å—Ç–∏ | üò¥ +6 | (25% —à–∞–Ω—Å: üì∏ —Å—Ñ–æ—Ç–∫–∞—Ç—å –ø–µ–Ω–∏—Å)');
            }
            
            // –ö–Ω–æ–ø–∫–∞ –±—Ä–∏—Ç—å—è
            if (gameState.godComplex > 50) {
                shaveBtn.disabled = true;
                shaveBtn.setAttribute('data-tooltip', '‚ùå –ú–Ω–µ –Ω–µ –Ω—É–∂–Ω–æ —Å–ª–µ–¥–∏—Ç—å –∑–∞ —Å–æ–±–æ–π (–∫–æ–º–ø–ª–µ–∫—Å –±–æ–≥–∞ ' + Math.round(gameState.godComplex) + '/100)');
            } else {
                shaveBtn.disabled = false;
                shaveBtn.setAttribute('data-tooltip', 'üß† +7 –∞–¥–µ–∫–≤–∞—Ç–Ω–æ—Å—Ç–∏ | üîª -7 –∏–Ω—Ü–µ–ª—å–Ω–æ—Å—Ç–∏ | üò¥ +4 | (35% —à–∞–Ω—Å: ü§≥ —Å–µ–ª—Ñ–∏)');
            }
            
            // –ö–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞ –∏–∑ –¥–æ–º–∞
            if (gameState.godComplex > 50) {
                goOutsideBtn.disabled = true;
                goOutsideBtn.setAttribute('data-tooltip', '‚ùå –û–Ω–∏ –Ω–µ–¥–æ—Å—Ç–æ–π–Ω—ã –º–µ–Ω—è –≤–∏–¥–µ—Ç—å (–∫–æ–º–ø–ª–µ–∫—Å –±–æ–≥–∞ ' + Math.round(gameState.godComplex) + '/100)');
            } else if (gameState.fatigue >= 80) {
                goOutsideBtn.disabled = true;
                goOutsideBtn.setAttribute('data-tooltip', '‚ùå –°–ª–∏—à–∫–æ–º —É—Å—Ç–∞–ª –¥–ª—è –ø—Ä–æ–≥—É–ª–∫–∏ (—É—Å—Ç–∞–ª–æ—Å—Ç—å ' + Math.round(gameState.fatigue) + '/100)');
            } else {
                goOutsideBtn.disabled = false;
                goOutsideBtn.setAttribute('data-tooltip', 'üß† +8 –∞–¥–µ–∫–≤–∞—Ç–Ω–æ—Å—Ç–∏ | üò¥ +18 —É—Å—Ç–∞–ª–æ—Å—Ç–∏ | üòä +3 –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è');
            }
            
            // –ö–Ω–æ–ø–∫–∞ –µ–¥—ã –æ—Ç —Ä–æ–¥–∏—Ç–µ–ª–µ–π
            const askFoodBtn = document.getElementById('askFoodBtn');
            if (gameState.parentFoodToday >= 3) {
                askFoodBtn.disabled = true;
                askFoodBtn.setAttribute('data-tooltip', '‚ùå –†–æ–¥–∏—Ç–µ–ª–∏ —É–∂–µ –Ω–µ –¥–∞–¥—É—Ç –µ–¥—ã —Å–µ–≥–æ–¥–Ω—è (–ª–∏–º–∏—Ç 3)');
            } else {
                askFoodBtn.disabled = false;
                askFoodBtn.setAttribute('data-tooltip', 'üçî +35 —Å—ã—Ç–æ—Å—Ç–∏ | üòä -8 –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è | –û—Å—Ç–∞–ª–æ—Å—å: ' + (3 - gameState.parentFoodToday) + '/3');
            }
            
            // –ö–Ω–æ–ø–∫–∞ –∑–≤–æ–Ω–∫–∞ –í–∏–∫–µ
            const callVikaBtn = document.getElementById('callVikaBtn');
            // Calculate dynamic success chance for tooltip
            const baseChance = 75;
            const incelPenalty = (gameState.incel - 50) * 0.5;
            const godComplexPenalty = (gameState.godComplex - 40) * 0.3;
            let successChance = baseChance - incelPenalty - godComplexPenalty;
            successChance = Math.max(5, Math.min(95, successChance));
            
            if (gameState.adequacy < 35) {
                callVikaBtn.disabled = true;
                callVikaBtn.setAttribute('data-tooltip', '‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∞–¥–µ–∫–≤–∞—Ç–Ω–æ—Å—Ç–∏ (–Ω—É–∂–Ω–æ 35+, –µ—Å—Ç—å ' + Math.round(gameState.adequacy) + ')');
            } else if (gameState.money < 10000) {
                callVikaBtn.disabled = true;
                callVikaBtn.setAttribute('data-tooltip', '‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥ (–Ω—É–∂–Ω–æ 10000‚ÇΩ)');
            } else {
                callVikaBtn.disabled = false;
                callVikaBtn.setAttribute('data-tooltip', 'üí∞ -10000‚ÇΩ | üß† —Ç—Ä–µ–±—É–µ—Ç 35+ –∞–¥–µ–∫–≤–∞—Ç–Ω–æ—Å—Ç–∏ | üò¥ +20 | –®–∞–Ω—Å: ' + Math.round(successChance) + '%');
            }
            
            // –ö–Ω–æ–ø–∫–∞ –ø–æ—Å—Ç–∏–Ω–≥–∞ –≤ –ê–Ø–ï–ß
            const postBtn = document.getElementById('postBtn');
            if (gameState.fatigue >= 80) {
                postBtn.disabled = true;
                postBtn.setAttribute('data-tooltip', '‚ùå –°–ª–∏—à–∫–æ–º —É—Å—Ç–∞–ª –¥–ª—è –ø–æ—Å—Ç–∏–Ω–≥–∞ (—É—Å—Ç–∞–ª–æ—Å—Ç—å ' + Math.round(gameState.fatigue) + '/100)');
            } else {
                postBtn.disabled = false;
                postBtn.setAttribute('data-tooltip', 'üòä +8 –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è | üìà +8 –∏–Ω—Ü–µ–ª—å–Ω–æ—Å—Ç–∏ | üò¥ +12 —É—Å—Ç–∞–ª–æ—Å—Ç–∏');
            }
            
            // –ö–Ω–æ–ø–∫–∞ –ú–∞–º–±—ã
            const mambaBtn = document.getElementById('mambaBtn');
            if (gameState.money < 8000) {
                mambaBtn.disabled = true;
                mambaBtn.setAttribute('data-tooltip', '‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥ (–Ω—É–∂–Ω–æ 8000‚ÇΩ)');
            } else {
                mambaBtn.disabled = false;
                mambaBtn.setAttribute('data-tooltip', 'üí∞ -8000‚ÇΩ | üòä +35 –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è | ‚ù§Ô∏è -18 –∑–¥–æ—Ä–æ–≤—å—è | üò¥ +10 —É—Å—Ç–∞–ª–æ—Å—Ç–∏');
            }
            
            // –ö–Ω–æ–ø–∫–∞ –±–æ–ª—å–Ω–∏—Ü—ã
            const hospitalBtn = document.getElementById('hospitalBtn');
            if (gameState.hospitalToday) {
                hospitalBtn.disabled = true;
                hospitalBtn.setAttribute('data-tooltip', '‚ùå –£–∂–µ –±—ã–ª –≤ –±–æ–ª—å–Ω–∏—Ü–µ —Å–µ–≥–æ–¥–Ω—è');
            } else if (gameState.money < 2000) {
                hospitalBtn.disabled = true;
                hospitalBtn.setAttribute('data-tooltip', '‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥ (–Ω—É–∂–Ω–æ 2000‚ÇΩ)');
            } else {
                hospitalBtn.disabled = false;
                hospitalBtn.setAttribute('data-tooltip', '‚ù§Ô∏è +25 –∑–¥–æ—Ä–æ–≤—å—è | üí∞ -2000‚ÇΩ | üò¥ +20 | üòä -12 | üß† +5 | 1 —Ä–∞–∑/–¥–µ–Ω—å');
            }
            
            // –ö–Ω–æ–ø–∫–∞ –¥—Ä–æ—á–∫–∏
            const masturbateBtn = document.querySelector('[onclick="masturbate()"]');
            if (gameState.fatigue >= 80) {
                masturbateBtn.disabled = true;
                masturbateBtn.setAttribute('data-tooltip', '‚ùå –°–ª–∏—à–∫–æ–º —É—Å—Ç–∞–ª –¥–∞–∂–µ –¥–ª—è —ç—Ç–æ–≥–æ (—É—Å—Ç–∞–ª–æ—Å—Ç—å ' + Math.round(gameState.fatigue) + '/100)');
            } else {
                masturbateBtn.disabled = false;
                masturbateBtn.setAttribute('data-tooltip', 'üòä +8 –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è | ‚ù§Ô∏è +2 –∑–¥–æ—Ä–æ–≤—å—è | üìà +10 –∏–Ω—Ü–µ–ª—å–Ω–æ—Å—Ç–∏ | üß† -10 –∞–¥–µ–∫–≤–∞—Ç–Ω–æ—Å—Ç–∏ | üò¥ +7 —É—Å—Ç–∞–ª–æ—Å—Ç–∏ | –ë–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ —É—Å—Ç–∞–ª–æ—Å—Ç–∏ ‚â•80');
            }
            
            // –ö–Ω–æ–ø–∫–∞ –º–µ—Ç—Ä–æ
            const metroBtn = document.getElementById('metroBtn');
            if (gameState.money < 50) {
                metroBtn.disabled = true;
                metroBtn.setAttribute('data-tooltip', '‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥ (–Ω—É–∂–Ω–æ 50‚ÇΩ)');
            } else if (gameState.fatigue >= 80) {
                metroBtn.disabled = true;
                metroBtn.setAttribute('data-tooltip', '‚ùå –°–ª–∏—à–∫–æ–º —É—Å—Ç–∞–ª –¥–ª—è –ø–æ–µ–∑–¥–∫–∏ (—É—Å—Ç–∞–ª–æ—Å—Ç—å ' + Math.round(gameState.fatigue) + '/100)');
            } else {
                metroBtn.disabled = false;
                metroBtn.setAttribute('data-tooltip', 'üëë -25 –∫–æ–º–ø–ª–µ–∫—Å–∞ –±–æ–≥–∞ | üìà +18 –∏–Ω—Ü–µ–ª—å–Ω–æ—Å—Ç–∏ | üò¥ +15 | üí∞ -50‚ÇΩ | üòä +3 | üß† -3');
            }
        }

        // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π
        function addLog(message, type = 'normal') {
            const log = document.getElementById('eventLog');
            if (!log) {
                console.error('Event log container not found!');
                return;
            }
            
            // –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
            const entry = document.createElement('div');
            entry.className = 'log-entry ' + type;
            entry.innerHTML = message;
            
            // –î–æ–±–∞–≤–∏—Ç—å –í –ù–ê–ß–ê–õ–û (–Ω–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è —Å–≤–µ—Ä—Ö—É)
            if (log.firstChild) {
                log.insertBefore(entry, log.firstChild);
            } else {
                log.appendChild(entry);
            }
            
            // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–ø–∏—Å–µ–π (max 50)
            while (log.children.length > 50) {
                log.removeChild(log.lastChild);
            }
        }

        // –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º
        function changeStat(stat, amount) {
            // CRITICAL: All stats are 0-100, including MOOD (not 50-100!)
            gameState[stat] += amount;
            gameState[stat] = Math.max(0, Math.min(100, gameState[stat]));
            
            // Alert when fatigue gets too high
            if (stat === 'fatigue' && gameState.fatigue >= 80 && gameState.fatigue - amount < 80) {
                addLog(`<strong>‚ö†Ô∏è –£—Å—Ç–∞–ª–æ—Å—Ç—å –∫—Ä–∏—Ç–∏—á–Ω–∞!</strong><br>–ú–∞—Ç–≤–µ–π —Å–æ–≤—Å–µ–º –æ–±–µ—Å—Å–∏–ª–µ–Ω. –ü–æ—Ä–∞ —Å–ø–∞—Ç—å.`, 'danger');
            }
            
            // –ò–Ω–≤–µ—Ä—Å–Ω–∞—è —Å–≤—è–∑—å –∞–¥–µ–∫–≤–∞—Ç–Ω–æ—Å—Ç–∏ –∏ –∏–Ω—Ü–µ–ª—å–Ω–æ—Å—Ç–∏
            if (stat === 'adequacy') {
                gameState.incel = Math.max(0, Math.min(100, 100 - gameState.adequacy));
            } else if (stat === 'incel') {
                gameState.adequacy = Math.max(0, Math.min(100, 100 - gameState.incel));
            }
        }

        // –î–µ–π—Å—Ç–≤–∏—è –∏–≥—Ä–æ–∫–∞
        function work() {
            if (gameState.fatigue >= 80) {
                addLog(`<strong>–†–∞–±–æ—Ç–∞</strong><br>–°–ª–∏—à–∫–æ–º —É—Å—Ç–∞–ª –¥–ª—è —ç—Ç–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è. –ù—É–∂–Ω–æ –ø–æ—Å–ø–∞—Ç—å.`, 'danger');
                return;
            }
            
            if (gameState.godComplex > 50) {
                addLog(`<strong>–†–∞–±–æ—Ç–∞</strong><br>‚ùå –Ø —Å–ª–∏—à–∫–æ–º –∫—Ä—É—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã! –ö–æ–º–ø–ª–µ–∫—Å –±–æ–≥–∞ —Å–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫.`, 'danger');
                return;
            }
            
            // Show work choice modal
            document.getElementById('workChoiceModal').style.display = 'flex';
        }

        function closeWorkChoice() {
            document.getElementById('workChoiceModal').style.display = 'none';
        }

        function chooseWork(type) {
            closeWorkChoice();
            hapticFeedback('light');
            
            if (type === 'asphalt') {
                workAsphalt();
            } else if (type === 'delivery') {
                workDelivery();
            }
        }

        function workAsphalt() {
            const salary = Math.floor(Math.random() * (3800 - 2200 + 1)) + 2200;  // Rebalanced: 2200-3800
            
            changeStat('health', -15);  // Increased from -13
            changeStat('mood', -8);  // Increased from -7
            changeStat('fatigue', 25);  // Increased from 20
            changeStat('incel', 8);  // Increased from 7
            changeStat('adequacy', 3);  // Decreased from 5
            gameState.money += salary;
            gameState.stats.workShifts++;
            gameState.stats.totalMoneyEarned += salary;
            
            let logText = `<strong>üöß –†–∞–±–æ—Ç–∞ —É–∫–ª–∞–¥—á–∏–∫–æ–º –∞—Å—Ñ–∞–ª—å—Ç–∞</strong><br>–ú–∞—Ç–≤–µ–π –ø—Ä–æ–≤–µ–ª —Ç—è–∂–µ–ª—É—é —Å–º–µ–Ω—É –Ω–∞ —Å—Ç—Ä–æ–π–∫–µ. –ó–∞—Ä–∞–±–æ—Ç–∞–ª ${salary.toLocaleString('ru-RU')}‚ÇΩ. -13 –∑–¥–æ—Ä–æ–≤—å—è, -7 –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è, +20 —É—Å—Ç–∞–ª–æ—Å—Ç–∏, +7 –∏–Ω—Ü–µ–ª—å–Ω–æ—Å—Ç–∏, +5 –∞–¥–µ–∫–≤–∞—Ç–Ω–æ—Å—Ç–∏.`;
            
            // Random events
            const rand = Math.random() * 100;
            if (rand < 12) {
                // Scandal with colleagues (12%)
                changeStat('mood', -13);
                changeStat('incel', 12);
                logText += `<br><span style="color: #ff4444;">üò† –°–∫–∞–Ω–¥–∞–ª —Å –∫–æ–ª–ª–µ–≥–∞–º–∏! –ù–∞—á–∞–ª—å–Ω–∏–∫ –æ—Ä–∞–ª –Ω–∞ –≤—Å–µ—Ö. -13 –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è, +12 –∏–Ω—Ü–µ–ª—å–Ω–æ—Å—Ç–∏</span>`;
            } else if (rand < 18) {
                // Boss praised (6%)
                changeStat('mood', 15);
                gameState.money += 600;
                gameState.stats.totalMoneyEarned += 600;
                logText += `<br><span style="color: #44ff44;">üéâ –†–∞–Ω–æ –∑–∞–∫–æ–Ω—á–∏–ª–∏ —Å–º–µ–Ω—É, –Ω–∞—á–∞–ª—å–Ω–∏–∫ –ø–æ—Ö–≤–∞–ª–∏–ª! +15 –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è, +600‚ÇΩ</span>`;
            } else if (rand < 26) {
                // Fine for defect (8%)
                gameState.money -= 900;
                gameState.money = Math.max(0, gameState.money);
                changeStat('adequacy', -5);
                changeStat('mood', -6);
                logText += `<br><span style="color: #ff4444;">‚ö†Ô∏è –ê—Å—Ñ–∞–ª—å—Ç –Ω–µ –∑–∞—Å–æ—Ö ‚Äî —à—Ç—Ä–∞—Ñ –∑–∞ –±—Ä–∞–∫! -900‚ÇΩ, -5 –∞–¥–µ–∫–≤–∞—Ç–Ω–æ—Å—Ç–∏, -6 –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è</span>`;
            }
            
            addLog(logText);
            hapticFeedback('medium');
            saveGameThrottled();
            checkAchievementsProgress();
            updateUI();
            checkGameOver();
        }

        function workDelivery() {
            const salary = Math.floor(Math.random() * (1500 - 800 + 1)) + 800;  // Rebalanced: 800-1500
            
            changeStat('health', -8);  // Increased from -7
            changeStat('mood', -3);  // Increased from -2
            changeStat('fatigue', 15);  // Increased from 12
            changeStat('incel', 4);  // Increased from 3
            changeStat('adequacy', 6);  // Decreased from 7
            gameState.money += salary;
            gameState.stats.workShifts++;
            gameState.stats.totalMoneyEarned += salary;
            
            let logText = `<strong>üö¥ –†–∞–±–æ—Ç–∞ –¥–æ—Å—Ç–∞–≤—â–∏–∫–æ–º –µ–¥—ã</strong><br>–ú–∞—Ç–≤–µ–π –æ—Ç—Ä–∞–±–æ—Ç–∞–ª —Å–º–µ–Ω—É –Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–µ. –ó–∞—Ä–∞–±–æ—Ç–∞–ª ${salary.toLocaleString('ru-RU')}‚ÇΩ. -7 –∑–¥–æ—Ä–æ–≤—å—è, -2 –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è, +12 —É—Å—Ç–∞–ª–æ—Å—Ç–∏, +3 –∏–Ω—Ü–µ–ª—å–Ω–æ—Å—Ç–∏, +7 –∞–¥–µ–∫–≤–∞—Ç–Ω–æ—Å—Ç–∏.`;
            
            // Random events
            const rand = Math.random() * 100;
            if (rand < 15) {
                // Tips (15%)
                gameState.money += 200;
                gameState.stats.totalMoneyEarned += 200;
                changeStat('mood', 6);
                logText += `<br><span style="color: #44ff44;">üíµ –ö–ª–∏–µ–Ω—Ç –æ—Å—Ç–∞–≤–∏–ª —á–∞–µ–≤—ã–µ! +200‚ÇΩ, +6 –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è</span>`;
            } else if (rand < 21) {
                // Rain (6%)
                changeStat('health', -11);
                changeStat('mood', -7);
                logText += `<br><span style="color: #4a9eff;">üåßÔ∏è –ü–æ–ø–∞–ª –ø–æ–¥ –¥–æ–∂–¥—å! –ü—Ä–æ–º–æ–∫ –Ω–∞—Å–∫–≤–æ–∑—å. -11 –∑–¥–æ—Ä–æ–≤—å—è, -7 –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è</span>`;
            } else if (rand < 28) {
                // Dog (7%)
                changeStat('incel', 9);
                changeStat('mood', -5);
                logText += `<br><span style="color: #ffaa00;">üêï –ù–∞–≥–ª–∞—è —Å–æ–±–∞–∫–∞! –ß—É—Ç—å –Ω–µ —É–∫—É—Å–∏–ª–∞ –∑–∞ –Ω–æ–≥—É. -5 –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è, +9 –∏–Ω—Ü–µ–ª—å–Ω–æ—Å—Ç–∏</span>`;
            }
            
            addLog(logText);
            hapticFeedback('medium');
            saveGameThrottled();
            checkAchievementsProgress();
            updateUI();
            checkGameOver();
        }

        function wash() {
            if (gameState.godComplex > 50) {
                addLog(`<strong>–ü–æ–º—ã—Ç—å—Å—è</strong><br>‚ùå –Ø —Å–ª–∏—à–∫–æ–º –∫—Ä—É—Ç, —á—Ç–æ–±—ã –º—ã—Ç—å—Å—è! –ö–æ–º–ø–ª–µ–∫—Å –±–æ–≥–∞ —Å–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫.`, 'danger');
                return;
            }
            
            changeStat('adequacy', 8);  // Decreased from 10
            changeStat('fatigue', 6);  // Increased from 5
            gameState.stats.washCount++;
            
            // 25% chance for dick pic event (decreased from 30%)
            if (Math.random() < 0.25) {
                const dickPicTexts = [
                    '–ü–æ–∫–∞ –º—ã–ª—Å—è, –ú–∞—Ç–≤–µ–π —Å—Ñ–æ—Ç–∫–∞–ª —Å–≤–æ–π —á–ª–µ–Ω –∏ –∑–∞–ø–æ—Å—Ç–∏–ª –≤ –ê–Ø–ï–ß. –ü–æ–ª—É—á–∏–ª –Ω–µ—Å–∫–æ–ª—å–∫–æ –ª–∞–π–∫–æ–≤ –æ—Ç –¥—Ä—É–≥–∏—Ö –∏–Ω—Ü–µ–ª–æ–≤.',
                    '–ú–∞—Ç–≤–µ–π —Ä–µ—à–∏–ª –∑–∞–ø–µ—á–∞—Ç–ª–µ—Ç—å —Å–≤–æ–µ –¥–æ—Å—Ç–æ–∏–Ω—Å—Ç–≤–æ –∏ –≤—ã–ª–æ–∂–∏—Ç—å —Ñ–æ—Ç–æ. –ö–æ–º–ø–ª–µ–∫—Å—ã –Ω–µ–º–Ω–æ–≥–æ –æ—Ç—Å—Ç—É–ø–∏–ª–∏.'
                ];
                const eventText = dickPicTexts[Math.floor(Math.random() * dickPicTexts.length)];
                
                changeStat('mood', 12);  // Decreased from 15
                changeStat('godComplex', 12);  // Increased from 10
                changeStat('adequacy', -20); // This makes total adequacy effect: +8-20 = -12
                gameState.stats.dickPics++;
                
                addLog(`<strong>üì∏üçÜ –ü–æ–º—ã–ª—Å—è + –°—Ñ–æ—Ç–∫–∞–ª –ø–µ–Ω–∏—Å!</strong><br>${eventText}<br>–ò—Ç–æ–≥–æ: -12 –∞–¥–µ–∫–≤–∞—Ç–Ω–æ—Å—Ç–∏, -8 –∏–Ω—Ü–µ–ª—å–Ω–æ—Å—Ç–∏, +6 —É—Å—Ç–∞–ª–æ—Å—Ç–∏, +12 –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è, +12 –∫–æ–º–ø–ª–µ–∫—Å–∞ –±–æ–≥–∞.`, 'event');
            } else {
                addLog(`<strong>–ü–æ–º—ã–ª—Å—è</strong><br>–¢—ã –ø—Ä–∏–Ω—è–ª –¥—É—à. –ß—É–≤—Å—Ç–≤—É–µ—à—å —Å–µ–±—è –ø–æ—á—Ç–∏ —á–µ–ª–æ–≤–µ–∫–æ–º. +8 –∞–¥–µ–∫–≤–∞—Ç–Ω–æ—Å—Ç–∏, -8 –∏–Ω—Ü–µ–ª—å–Ω–æ—Å—Ç–∏, +6 —É—Å—Ç–∞–ª–æ—Å—Ç–∏.`);
            }
            
            hapticFeedback('light');
            saveGameThrottled();
            checkAchievementsProgress();
            updateUI();
        }

        function shave() {
            if (gameState.godComplex > 50) {
                addLog(`<strong>–ü–æ–±—Ä–∏—Ç—å—Å—è</strong><br>‚ùå –ú–Ω–µ –Ω–µ –Ω—É–∂–Ω–æ —Å–ª–µ–¥–∏—Ç—å –∑–∞ —Å–æ–±–æ–π! –ö–æ–º–ø–ª–µ–∫—Å –±–æ–≥–∞ —Å–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫.`, 'danger');
                return;
            }
            
            changeStat('adequacy', 7);  // Decreased from 8
            changeStat('fatigue', 4);  // Increased from 3
            gameState.stats.shaveCount++;
            
            // 35% chance for selfie event (decreased from 40%)
            if (Math.random() < 0.35) {
                const selfieTexts = [
                    '–ü–æ–±—Ä–∏–≤—à–∏—Å—å, –ú–∞—Ç–≤–µ–π —Å–¥–µ–ª–∞–ª —Å–µ–ª—Ñ–∏. –í—ã–≥–ª—è–¥–∏—Ç –Ω–µ–ø–ª–æ—Ö–æ! –î–∞–∂–µ –ø–æ–ª—É—á–∏–ª –∫–æ–º–ø–ª–∏–º–µ–Ω—Ç –≤ –∫–æ–Ω—Ñ–µ.',
                    '–ü–æ—Å–ª–µ –±—Ä–∏—Ç—å—è –ú–∞—Ç–≤–µ–π –ø–æ—á—É–≤—Å—Ç–≤–æ–≤–∞–ª —Å–µ–±—è —É–≤–µ—Ä–µ–Ω–Ω–µ–µ. –°–µ–ª—Ñ–∏ –≤—ã—à–ª–æ —É–¥–∞—á–Ω—ã–º.'
                ];
                const eventText = selfieTexts[Math.floor(Math.random() * selfieTexts.length)];
                
                changeStat('mood', 10);  // Decreased from 12
                changeStat('adequacy', 6); // This makes total adequacy effect: +7+6 = +13
                
                addLog(`<strong>ü§≥ –ü–æ–±—Ä–∏–ª—Å—è + –°–µ–ª—Ñ–∏!</strong><br>${eventText}<br>–ò—Ç–æ–≥–æ: +13 –∞–¥–µ–∫–≤–∞—Ç–Ω–æ—Å—Ç–∏, -7 –∏–Ω—Ü–µ–ª—å–Ω–æ—Å—Ç–∏, +4 —É—Å—Ç–∞–ª–æ—Å—Ç–∏, +10 –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è.`, 'event');
            } else {
                addLog(`<strong>–ü–æ–±—Ä–∏–ª—Å—è</strong><br>–¢—ã –∏–∑–±–∞–≤–∏–ª—Å—è –æ—Ç —â–µ—Ç–∏–Ω—ã. –í—ã–≥–ª—è–¥–∏—à—å —á—É—Ç—å –ø—Ä–∏–ª–∏—á–Ω–µ–µ. +7 –∞–¥–µ–∫–≤–∞—Ç–Ω–æ—Å—Ç–∏, -7 –∏–Ω—Ü–µ–ª—å–Ω–æ—Å—Ç–∏, +4 —É—Å—Ç–∞–ª–æ—Å—Ç–∏.`);
            }
            
            hapticFeedback('light');
            saveGameThrottled();
            checkAchievementsProgress();
            updateUI();
        }

        function goOutside() {
            if (gameState.godComplex > 50) {
                addLog(`<strong>–í—ã—Ö–æ–¥ –∏–∑ –¥–æ–º–∞</strong><br>‚ùå –û–Ω–∏ –Ω–µ–¥–æ—Å—Ç–æ–π–Ω—ã –º–µ–Ω—è –≤–∏–¥–µ—Ç—å! –ö–æ–º–ø–ª–µ–∫—Å –±–æ–≥–∞ —Å–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫.`, 'danger');
                return;
            }
            
            if (gameState.fatigue >= 80) {
                addLog(`<strong>–í—ã—Ö–æ–¥ –∏–∑ –¥–æ–º–∞</strong><br>–°–ª–∏—à–∫–æ–º —É—Å—Ç–∞–ª –¥–ª—è —ç—Ç–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è. –ù—É–∂–Ω–æ –ø–æ—Å–ø–∞—Ç—å.`, 'danger');
                return;
            }
            
            changeStat('adequacy', 8);  // Increased from 5
            changeStat('fatigue', 18);  // Increased from 15
            changeStat('mood', 3);  // New addition
            gameState.stats.outsideCount++;
            gameState.stats.daysWithoutOutside = 0;
            
            let logText = `<strong>–í—ã—Ö–æ–¥ –∏–∑ –¥–æ–º–∞</strong><br>–ü—Ä–æ–≥—É–ª—è–ª—Å—è –ø–æ –ü–∏—Ç–µ—Ä—É. +8 –∞–¥–µ–∫–≤–∞—Ç–Ω–æ—Å—Ç–∏, +18 —É—Å—Ç–∞–ª–æ—Å—Ç–∏, +3 –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è.`;
            
            // Random events
            const rand = Math.random();
            if (rand < 0.05) {
                // Found money (5%)
                gameState.money += 200;
                logText += `<br><span style="color: #44ff44;">üí∞ –ù–∞—à–µ–ª 200‚ÇΩ –Ω–∞ –∑–µ–º–ª–µ!</span>`;
            } else if (rand < 0.15) {
                // Met friend (10%)
                changeStat('mood', 15);
                changeStat('adequacy', 10);
                logText += `<br><span style="color: #4a9eff;">üëã –í—Å—Ç—Ä–µ—Ç–∏–ª —Å—Ç–∞—Ä–æ–≥–æ –¥—Ä—É–≥–∞! +15 –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è, +10 –∞–¥–µ–∫–≤–∞—Ç–Ω–æ—Å—Ç–∏</span>`;
            } else if (rand < 0.30) {
                // Saw couple (15%)
                changeStat('mood', -15);
                changeStat('incel', 10);
                logText += `<br><span style="color: #ff4444;">üíî –£–≤–∏–¥–µ–ª —Å—á–∞—Å—Ç–ª–∏–≤—É—é –ø–∞—Ä—É... -15 –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è, +10 –∏–Ω—Ü–µ–ª—å–Ω–æ—Å—Ç–∏</span>`;
            }
            
            addLog(logText);
            hapticFeedback('light');
            saveGameThrottled();
            checkAchievementsProgress();
            updateUI();
        }

        function askParentsFood() {
            if (gameState.parentFoodToday >= 3) {
                addLog(`<strong>–ï–¥–∞ –æ—Ç —Ä–æ–¥–∏—Ç–µ–ª–µ–π</strong><br>–†–æ–¥–∏—Ç–µ–ª–∏ —É—Å—Ç–∞–ª–∏ –æ—Ç —Ç–≤–æ–∏—Ö –ø—Ä–æ—Å—å–± —Å–µ–≥–æ–¥–Ω—è. –ü–æ–ø—Ä–æ–±—É–π –∑–∞–≤—Ç—Ä–∞.`, 'danger');
                return;
            }
            
            changeStat('satiety', 35);  // Increased from 30
            changeStat('mood', -8);  // Increased penalty from -5
            gameState.parentFoodToday++;
            
            let logText = `<strong>–ï–¥–∞ –æ—Ç —Ä–æ–¥–∏—Ç–µ–ª–µ–π</strong><br>`;
            
            // Random events
            const rand = Math.random();
            if (rand < 0.15) {
                // Father gives money (15%)
                gameState.money += 1000;
                changeStat('godComplex', -5);
                logText += `–û—Ç–µ—Ü –¥–∞–ª 1000‚ÇΩ –∏ –µ–¥—É. +35 —Å—ã—Ç–æ—Å—Ç–∏, -8 –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è, -5 –∫–æ–º–ø–ª–µ–∫—Å–∞ –±–æ–≥–∞.`;
                logText += `<br><span style="color: #4a9eff;">üí∞ –û—Ç–µ—Ü –ø–æ–¥–∫–∏–Ω—É–ª –¥–µ–Ω–µ–≥ –∏–∑ –∂–∞–ª–æ—Å—Ç–∏</span>`;
            } else if (rand < 0.35) {
                // Mother scolds (20%)
                changeStat('mood', -10); // -5 base + -10 extra = -15 total
                changeStat('incel', 10);
                logText += `–ú–∞—Ç—å –æ—Ç—á–∏—Ç–∞–ª–∞ –∑–∞ —Ç—É–Ω–µ—è–¥—Å—Ç–≤–æ. +35 —Å—ã—Ç–æ—Å—Ç–∏, -18 –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è, +10 –∏–Ω—Ü–µ–ª—å–Ω–æ—Å—Ç–∏.`;
                logText += `<br><span style="color: #ff4444;">üò§ "–ö–æ–≥–¥–∞ –∂–µ —Ç—ã –Ω–∞–π–¥–µ—à—å –Ω–æ—Ä–º–∞–ª—å–Ω—É—é —Ä–∞–±–æ—Ç—É?!"</span>`;
            } else {
                const responses = [
                    '–ú–∞–º–∞ —Å —É–∫–æ—Ä–∏–∑–Ω–æ–π –¥–∞–ª–∞ —Ç–µ–±–µ –º–∞–∫–∞—Ä–æ–Ω—ã —Å —Å–æ—Å–∏—Å–∫–æ–π.',
                    '–û—Ç–µ—Ü –º–æ–ª—á–∞ –ø–µ—Ä–µ–¥–∞–ª —Ç–µ–±–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –µ–¥–æ–π.',
                    '–†–æ–¥–∏—Ç–µ–ª–∏ –Ω–∞–∫–æ—Ä–º–∏–ª–∏, –Ω–æ —Å—Ç—ã–¥ —Ç–µ–±—è –≥–ª–æ–∂–µ—Ç.'
                ];
                logText += `${responses[Math.floor(Math.random() * responses.length)]} +35 —Å—ã—Ç–æ—Å—Ç–∏, -8 –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è.`;
            }
            
            logText += ` –û—Å—Ç–∞–ª–æ—Å—å –ø–æ–ø—ã—Ç–æ–∫ —Å–µ–≥–æ–¥–Ω—è: ${3 - gameState.parentFoodToday}`;
            addLog(logText);
            hapticFeedback('light');
            saveGameThrottled();
            updateUI();
        }

        function eatTrash() {
            changeStat('satiety', 25);  // Decreased from 30
            changeStat('incel', 15);  // Increased from 10
            changeStat('health', -8);  // Increased from -5
            changeStat('adequacy', -5);  // New penalty
            gameState.stats.trashMeals++;
            
            const events = [
                '–ù–∞—à—ë–ª –ø–æ—á—Ç–∏ —Å–≤–µ–∂–∏–π –ø–∏—Ä–æ–∂–æ–∫ –≤ –ø–æ–º–æ–π–∫–µ –∑–∞ –º–∞–≥–∞–∑–∏–Ω–æ–º.',
                '–î–æ—Å—Ç–∞–ª –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –Ω–µ–¥–æ–µ–¥–µ–Ω–Ω—É—é —à–∞—É—Ä–º—É. –í–∫—É—Å —Å—Ç—Ä–∞–Ω–Ω—ã–π, –Ω–æ —Å–æ–π–¥—ë—Ç.',
                '–†–∞—Å–∫–æ–ø–∞–ª –≤ –º—É—Å–æ—Ä–∫–µ —Ö–ª–µ–±. –ü–ª–µ—Å–µ–Ω—å –æ–±—Ä–µ–∑–∞–ª.'
            ];
            
            addLog(`<strong>–ü–æ–º–æ–π–∫–∞</strong><br>${events[Math.floor(Math.random() * events.length)]} +25 —Å—ã—Ç–æ—Å—Ç–∏, +15 –∏–Ω—Ü–µ–ª—å–Ω–æ—Å—Ç–∏, -8 –∑–¥–æ—Ä–æ–≤—å—è, -5 –∞–¥–µ–∫–≤–∞—Ç–Ω–æ—Å—Ç–∏.`, 'event');
            hapticFeedback('light');
            saveGameThrottled();
            checkAchievementsProgress();
            updateUI();
            checkGameOver();
        }

        function callVika() {
            if (gameState.adequacy < 35) {
                addLog(`<strong>–ó–≤–æ–Ω–æ–∫ –í–∏–∫–µ</strong><br>–¢—ã —Å–ª–∏—à–∫–æ–º –Ω–µ–∞–¥–µ–∫–≤–∞—Ç–µ–Ω –¥–ª—è —ç—Ç–æ–≥–æ. –ù—É–∂–Ω–æ —Ö–æ—Ç—è –±—ã 35 –∞–¥–µ–∫–≤–∞—Ç–Ω–æ—Å—Ç–∏.`, 'danger');
                return;
            }
            
            if (gameState.money < 10000) {
                addLog(`<strong>–ó–≤–æ–Ω–æ–∫ –í–∏–∫–µ</strong><br>–£ —Ç–µ–±—è –Ω–µ—Ç 10,000‚ÇΩ –Ω–∞ —ç—Ç—É –∞–≤–∞–Ω—Ç—é—Ä—É.`, 'danger');
                return;
            }
            
            // Calculate dynamic success chance
            const baseChance = 75;
            const incelPenalty = (gameState.incel - 50) * 0.5;
            const godComplexPenalty = (gameState.godComplex - 40) * 0.3;
            let successChance = baseChance - incelPenalty - godComplexPenalty;
            successChance = Math.max(5, Math.min(95, successChance));
            
            // CRITICAL: Decrease money (can go negative!)
            gameState.money -= 10000;
            gameState.stats.vikaMoneySpent += 10000;
            changeStat('fatigue', 20);
            
            addLog(`<strong>–ó–≤–æ–Ω–æ–∫ –í–∏–∫–µ</strong><br>–ü–æ–ø—ã—Ç–∫–∞ –ø–æ–∑–≤–æ–Ω–∏—Ç—å –í–∏–∫–µ... (—à–∞–Ω—Å —É—Å–ø–µ—Ö–∞: ${Math.round(successChance)}%)`, 'event');
            
            if (Math.random() * 100 < successChance) {
                // –£—Å–ø–µ—Ö
                changeStat('mood', 30);
                changeStat('health', 10);
                changeStat('godComplex', 5);
                gameState.vikaRelationship = Math.min(100, gameState.vikaRelationship + 10);
                gameState.stats.vikaCallsSuccess++;
                
                let vikaText = `<strong>–ó–≤–æ–Ω–æ–∫ –í–∏–∫–µ ‚úÖ</strong><br>–ù–µ–æ–∂–∏–¥–∞–Ω–Ω–æ, –Ω–æ –í–∏–∫–∞ —Å–æ–≥–ª–∞—Å–∏–ª–∞—Å—å –≤—Å—Ç—Ä–µ—Ç–∏—Ç—å—Å—è! –í—ã –ø—Ä–æ–≤–µ–ª–∏ –æ—Ç–ª–∏—á–Ω—ã–π –≤–µ—á–µ—Ä. +30 –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è, +10 –∑–¥–æ—Ä–æ–≤—å—è, +5 –∫–æ–º–ø–ª–µ–∫—Å–∞ –±–æ–≥–∞, +20 —É—Å—Ç–∞–ª–æ—Å—Ç–∏, +10 –æ—Ç–Ω–æ—à–µ–Ω–∏–π —Å –í–∏–∫–æ–π. -10,000‚ÇΩ`;
                
                if (gameState.vikaRelationship >= 100) {
                    vikaText += `<br><br><span style="color: #ff1493; font-size: 1.2em;">üíñüíñüíñ –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–´–ï –û–¢–ù–û–®–ï–ù–ò–Ø! üíñüíñüíñ</span><br>–í–∏–∫–∞ –≤–ª—é–±–∏–ª–∞—Å—å –≤ –ú–∞—Ç–≤–µ—è! –í–æ–∑–º–æ–∂–Ω–∞ —Ö–æ—Ä–æ—à–∞—è –∫–æ–Ω—Ü–æ–≤–∫–∞...`;
                }
                
                addLog(vikaText, 'event');
            } else {
                // –ü—Ä–æ–≤–∞–ª
                changeStat('mood', -40);
                changeStat('incel', 20);
                changeStat('godComplex', -10);
                gameState.vikaRelationship = Math.max(0, gameState.vikaRelationship - 15);
                gameState.stats.vikaCallsFail++;
                addLog(`<strong>–ó–≤–æ–Ω–æ–∫ –í–∏–∫–µ ‚ùå</strong><br>–í–∏–∫–∞ –ø–æ—Å–ª–∞–ª–∞ —Ç–µ–±—è –∫—É–¥–∞ –ø–æ–¥–∞–ª—å—à–µ. –î–µ–Ω—å–≥–∏ –ø–æ—Ç—Ä–∞—á–µ–Ω—ã –≤–ø—É—Å—Ç—É—é. -40 –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è, +20 –∏–Ω—Ü–µ–ª—å–Ω–æ—Å—Ç–∏, -10 –∫–æ–º–ø–ª–µ–∫—Å–∞ –±–æ–≥–∞, +20 —É—Å—Ç–∞–ª–æ—Å—Ç–∏, -15 –æ—Ç–Ω–æ—à–µ–Ω–∏–π —Å –í–∏–∫–æ–π. -10,000‚ÇΩ`, 'danger');
            }
            
            checkAchievementsProgress();
            updateUI();
            checkGameOver();
        }

        function postAyaech() {
            if (gameState.fatigue >= 80) {
                addLog(`<strong>–ê–Ø–ï–ß</strong><br>–°–ª–∏—à–∫–æ–º —É—Å—Ç–∞–ª –¥–ª—è —ç—Ç–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è. –ù—É–∂–Ω–æ –ø–æ—Å–ø–∞—Ç—å.`, 'danger');
                return;
            }
            
            changeStat('mood', 8);  // Decreased from 10
            changeStat('incel', 8);  // Increased from 5
            changeStat('fatigue', 12);  // Increased from 10
            gameState.stats.postsCount++;
            
            let logText = `<strong>–ê–Ø–ï–ß</strong><br>–ó–∞–ø–æ—Å—Ç–∏–ª –≤ –ê–Ø–ï–ß. +8 –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è, +8 –∏–Ω—Ü–µ–ª—å–Ω–æ—Å—Ç–∏, +12 —É—Å—Ç–∞–ª–æ—Å—Ç–∏.`;
            
            // Random events
            const rand = Math.random();
            if (rand < 0.25) {
                // Viral post (25%)
                changeStat('mood', 15); // +10 base + 15 = +25 total
                changeStat('godComplex', 10);
                logText += `<br><span style="color: #44ff44;">üî• –ü–æ—Å—Ç –Ω–∞–±—Ä–∞–ª –º–Ω–æ–≥–æ –ª–∞–π–∫–æ–≤! +15 –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è, +10 –∫–æ–º–ø–ª–µ–∫—Å–∞ –±–æ–≥–∞</span>`;
            } else if (rand < 0.40) {
                // Banned (15%)
                changeStat('mood', -20); // +10 base - 20 = -10 total
                changeStat('incel', 15); // +5 base + 15 = +20 total
                logText += `<br><span style="color: #ff4444;">üö´ –¢–µ–±—è –∑–∞–±–∞–Ω–∏–ª–∏ –Ω–∞ –¥–µ–Ω—å! -20 –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è, +15 –∏–Ω—Ü–µ–ª—å–Ω–æ—Å—Ç–∏</span>`;
            }
            
            addLog(logText);
            hapticFeedback('light');
            saveGameThrottled();
            checkAchievementsProgress();
            updateUI();
        }

        function masturbate() {
            // –ù–û–í–ê–Ø –ü–†–û–í–ï–†–ö–ê: –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø—Ä–∏ —É—Å—Ç–∞–ª–æ—Å—Ç–∏ ‚â•80
            if (gameState.fatigue >= 80) {
                addLog(`<strong>–î—Ä–æ—á–∫–∞</strong><br>‚ùå –°–ª–∏—à–∫–æ–º —É—Å—Ç–∞–ª –¥–∞–∂–µ –¥–ª—è —ç—Ç–æ–≥–æ...`, 'danger');
                return;
            }
            
            changeStat('mood', 8);  // Decreased from 10
            changeStat('health', 2);
            changeStat('incel', 10);  // Increased from 8
            changeStat('adequacy', -10);  // Increased penalty from -8
            changeStat('fatigue', 7);  // Increased from 5
            
            let logText = `<strong>–î—Ä–æ—á–∫–∞</strong><br>–ú–∞—Ç–≤–µ–π –ø–æ–¥—Ä–æ—á–∏–ª. +8 –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è, +2 –∑–¥–æ—Ä–æ–≤—å—è, +10 –∏–Ω—Ü–µ–ª—å–Ω–æ—Å—Ç–∏, -10 –∞–¥–µ–∫–≤–∞—Ç–Ω–æ—Å—Ç–∏, +7 —É—Å—Ç–∞–ª–æ—Å—Ç–∏.`;
            
            // Random events
            const rand = Math.random();
            if (rand < 0.10) {
                // Perfect video (10%)
                changeStat('mood', 5);
                logText += `<br><span style="color: #44ff44;">üòç –ù–∞—à–µ–ª –∏–¥–µ–∞–ª—å–Ω–æ–µ –≤–∏–¥–µ–æ! +5 –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è</span>`;
            } else if (rand < 0.25) {
                // Almost caught (15%)
                changeStat('mood', -15);
                changeStat('incel', 10);
                logText += `<br><span style="color: #ff4444;">üò± –†–æ–¥–∏—Ç–µ–ª–∏ —á—É—Ç—å –Ω–µ –∑–∞—Å—Ç—É–∫–∞–ª–∏! -15 –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è, +10 –∏–Ω—Ü–µ–ª—å–Ω–æ—Å—Ç–∏</span>`;
            }
            
            addLog(logText);
            hapticFeedback('light');
            saveGameThrottled();
            updateUI();
        }

        function orderMamba() {
            if (gameState.money < 8000) {
                addLog(`<strong>–ú–∞–º–±–∞</strong><br>–£ —Ç–µ–±—è –Ω–µ—Ç 8,000‚ÇΩ –Ω–∞ —ç—Ç—É –¥—Ä—è–Ω—å.`, 'danger');
                return;
            }
            
            // CRITICAL: Decrease money (can go negative!)
            gameState.money -= 8000;
            changeStat('mood', 35);  // Decreased from 40
            changeStat('health', -18);  // Increased from -15
            changeStat('fatigue', 10);  // New penalty
            
            let logText = `<strong>–ú–∞–º–±–∞ –∑–∞–∫–∞–∑–∞–Ω–∞</strong><br>–¢—ã –∑–∞–∫–∞–∑–∞–ª —Å–∏–Ω—Ç–µ—Ç–∏–∫—É. +35 –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è, -18 –∑–¥–æ—Ä–æ–≤—å—è, +10 —É—Å—Ç–∞–ª–æ—Å—Ç–∏. -8,000‚ÇΩ`;
            
            // Random events
            const rand = Math.random();
            if (rand < 0.20) {
                // Catfish (20%)
                changeStat('mood', -30); // +35 base - 30 = +5 total
                changeStat('incel', 20);
                changeStat('godComplex', 15);
                logText += `<br><span style="color: #ff4444;">üò± –ú–∞–º–±–∞ –æ–∫–∞–∑–∞–ª–∞—Å—å –ú–£–ñ–ò–ö–û–ú! –ö–∞–∫–æ–π –∫–æ—à–º–∞—Ä! -30 –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è, +20 –∏–Ω—Ü–µ–ª—å–Ω–æ—Å—Ç–∏, +15 –∫–æ–º–ø–ª–µ–∫—Å–∞ –±–æ–≥–∞</span>`;
            } else if (rand < 0.30) {
                // Great evening (10%)
                changeStat('mood', 20); // +35 + 20 = +55 total
                changeStat('incel', -10);
                logText += `<br><span style="color: #44ff44;">üíö –û—Ç–ª–∏—á–Ω—ã–π –≤–µ—á–µ—Ä! –ú–∞–º–±–∞ –±—ã–ª–∞ –æ–≥–æ–Ω—å! +20 –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è, -10 –∏–Ω—Ü–µ–ª—å–Ω–æ—Å—Ç–∏</span>`;
            }
            
            addLog(logText, 'event');
            hapticFeedback('medium');
            saveGameThrottled();
            updateUI();
            checkGameOver();
        }
        
        function goToHospital() {
            if (gameState.hospitalToday) {
                addLog(`<strong>–ë–æ–ª—å–Ω–∏—Ü–∞</strong><br>–£–∂–µ –±—ã–ª –≤ –±–æ–ª—å–Ω–∏—Ü–µ —Å–µ–≥–æ–¥–Ω—è. –ó–∞–≤—Ç—Ä–∞ –ø—Ä–∏—Ö–æ–¥–∏.`, 'danger');
                return;
            }
            
            if (gameState.money < 2000) {
                addLog(`<strong>–ë–æ–ª—å–Ω–∏—Ü–∞</strong><br>–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥ (–Ω—É–∂–Ω–æ 2000‚ÇΩ).`, 'danger');
                return;
            }
            
            // CRITICAL: Decrease money (can go negative!)
            gameState.money -= 2000;
            changeStat('health', 25);
            changeStat('fatigue', 20);  // Increased from 15
            changeStat('mood', -12);  // Increased penalty from -10
            changeStat('adequacy', 5);
            gameState.hospitalToday = true;
            gameState.stats.hospitalVisits++;
            
            let logText = `<strong>üè• –ë–æ–ª—å–Ω–∏—Ü–∞</strong><br>–ú–∞—Ç–≤–µ–π —Å—Ö–æ–¥–∏–ª –≤ –ø–æ–ª–∏–∫–ª–∏–Ω–∏–∫—É. +25 –∑–¥–æ—Ä–æ–≤—å—è, -10 –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è, +15 —É—Å—Ç–∞–ª–æ—Å—Ç–∏, +5 –∞–¥–µ–∫–≤–∞—Ç–Ω–æ—Å—Ç–∏. -2,000‚ÇΩ`;
            
            // Random events
            const rand = Math.random();
            if (rand < 0.20) {
                // Young doctor (20%)
                changeStat('mood', 10); // -10 base + 10 = 0 total
                changeStat('incel', -5);
                logText += `<br><span style="color: #4a9eff;">üíâ –ü–æ–ø–∞–ª–∞—Å—å –º–æ–ª–æ–¥–∞—è –≤—Ä–∞—á! +10 –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è, -5 –∏–Ω—Ü–µ–ª—å–Ω–æ—Å—Ç–∏</span>`;
            } else if (rand < 0.30) {
                // Found issues (10%)
                changeStat('mood', -10); // -10 base - 10 = -20 total
                logText += `<br><span style="color: #ff4444;">‚ö†Ô∏è –û–±–Ω–∞—Ä—É–∂–∏–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã —Å–æ –∑–¥–æ—Ä–æ–≤—å–µ–º... -10 –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è</span>`;
            }
            
            addLog(logText);
            hapticFeedback('light');
            saveGameThrottled();
            checkAchievementsProgress();
            updateUI();
        }

        function rideMetro() {
            if (gameState.money < 50) {
                addLog(`<strong>–ú–µ—Ç—Ä–æ</strong><br>–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥ –Ω–∞ –ø—Ä–æ–µ–∑–¥ (–Ω—É–∂–Ω–æ 50‚ÇΩ).`, 'danger');
                return;
            }
            
            if (gameState.fatigue >= 80) {
                addLog(`<strong>–ú–µ—Ç—Ä–æ</strong><br>–°–ª–∏—à–∫–æ–º —É—Å—Ç–∞–ª –¥–ª—è –ø–æ–µ–∑–¥–∫–∏. –ù—É–∂–Ω–æ –ø–æ—Å–ø–∞—Ç—å.`, 'danger');
                return;
            }
            
            // Base effects - can go into debt!
            gameState.money -= 50;
            changeStat('godComplex', -25);
            changeStat('incel', 18);  // Decreased from 20
            changeStat('fatigue', 15);
            changeStat('mood', 3);  // Decreased from 5
            changeStat('adequacy', -3);  // Decreased penalty from -5
            gameState.stats.metroRides++;
            
            let logText = `<strong>üöá –ú–µ—Ç—Ä–æ</strong><br>–ú–∞—Ç–≤–µ–π –ø—Ä–æ–∫–∞—Ç–∏–ª—Å—è –ø–æ –ø–µ—Ç–µ—Ä–±—É—Ä–≥—Å–∫–æ–º—É –º–µ—Ç—Ä–æ —Å—Ä–µ–¥–∏ –æ–±—ã—á–Ω—ã—Ö –ª—é–¥–µ–π. –†–µ–∞–ª—å–Ω–æ—Å—Ç—å –Ω–∞–ø–æ–º–Ω–∏–ª–∞ –æ —Å–µ–±–µ. -25 –∫–æ–º–ø–ª–µ–∫—Å–∞ –±–æ–≥–∞, +18 –∏–Ω—Ü–µ–ª—å–Ω–æ—Å—Ç–∏, +15 —É—Å—Ç–∞–ª–æ—Å—Ç–∏, +3 –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è, -3 –∞–¥–µ–∫–≤–∞—Ç–Ω–æ—Å—Ç–∏. -50‚ÇΩ`;
            
            // Random events (total ~50% chance, but each event is rare)
            const rand = Math.random() * 100;
            
            if (rand < 8) {
                // CRITICAL FIX: Alternative punishment when no money
                const fine = 3000;
                if (gameState.money >= fine) {
                    // Has money - pay fine normally
                    gameState.money -= fine;
                    changeStat('mood', -15);
                    changeStat('incel', 15);
                    gameState.stats.metroFined++;
                    logText += `<br><span style="color: #ff4444;">üö® –ü–æ–ø–∞–ª—Å—è –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä–∞–º –±–µ–∑ –±–∏–ª–µ—Ç–∞! –í—ã–ø–∏—Å–∞–ª–∏ —à—Ç—Ä–∞—Ñ 3000‚ÇΩ. –ü–æ–∑–æ—Ä... -15 –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è, +15 –∏–Ω—Ü–µ–ª—å–Ω–æ—Å—Ç–∏</span>`;
                } else {
                    // No money - psychological damage and debt
                    gameState.money -= fine;  // Goes into debt!
                    changeStat('mood', -30);  // Double penalty
                    changeStat('health', -15);  // Extra damage
                    changeStat('incel', 25);  // More incel
                    gameState.stats.metroFined++;
                    logText += `<br><span style="color: #ff4444;">üö® –ö–æ–Ω—Ç—Ä–æ–ª–µ—Ä—ã! –ù–µ—Ç –¥–µ–Ω–µ–≥ –Ω–∞ —à—Ç—Ä–∞—Ñ. –ü–æ–∑–æ—Ä –∏ –¥–µ–ø—Ä–µ—Å—Å–∏—è... -30 –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è, -15 –∑–¥–æ—Ä–æ–≤—å—è, +25 –∏–Ω—Ü–µ–ª—å–Ω–æ—Å—Ç–∏. –î–æ–ª–≥: ${gameState.money.toLocaleString('ru-RU')}‚ÇΩ</span>`;
                }
            } else if (rand < 20) {
                // –ö—Ä–∞—Å–∏–≤–∞—è –¥–µ–≤—É—à–∫–∞ (12%)
                changeStat('mood', -20);
                changeStat('incel', 15);
                changeStat('godComplex', -10);
                logText += `<br><span style="color: #ff4444;">üíî –í –≤–∞–≥–æ–Ω–µ –µ—Ö–∞–ª–∞ –∫—Ä–∞—Å–∏–≤–∞—è –¥–µ–≤—É—à–∫–∞. –û–Ω–∞ –¥–∞–∂–µ –Ω–µ –ø–æ—Å–º–æ—Ç—Ä–µ–ª–∞ –≤ —Å—Ç–æ—Ä–æ–Ω—É –ú–∞—Ç–≤–µ—è. –ë–æ–ª—å–Ω–æ... -20 –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è, +15 –∏–Ω—Ü–µ–ª—å–Ω–æ—Å—Ç–∏, -10 –∫–æ–º–ø–ª–µ–∫—Å–∞ –±–æ–≥–∞</span>`;
            } else if (rand < 30) {
                // –ü–æ–ø—Ä–æ—à–∞–π–∫–∞ (10%)
                if (Math.random() < 0.5) {
                    // –î–∞–ª –¥–µ–Ω–µ–≥ (can go negative)
                    gameState.money -= 100;
                    changeStat('mood', 10);
                    changeStat('incel', -5);
                    changeStat('godComplex', -10);
                    logText += `<br><span style="color: #4a9eff;">üôè –ü–æ–ø—Ä–æ—à–∞–π–∫–∞ –ø—Ä–æ—Å–∏–ª –¥–µ–Ω–µ–≥. –ú–∞—Ç–≤–µ–π –¥–∞–ª –µ–º—É 100‚ÇΩ. +10 –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è, -5 –∏–Ω—Ü–µ–ª—å–Ω–æ—Å—Ç–∏, -10 –∫–æ–º–ø–ª–µ–∫—Å–∞ –±–æ–≥–∞</span>`;
                } else {
                    // –ù–µ –¥–∞–ª
                    changeStat('mood', 5);
                    changeStat('incel', 10);
                    changeStat('godComplex', 5);
                    logText += `<br><span style="color: #ffaa00;">üí∞ –ü–æ–ø—Ä–æ—à–∞–π–∫–∞ –ø—Ä–æ—Å–∏–ª –¥–µ–Ω–µ–≥. –ú–∞—Ç–≤–µ–π –ø—Ä–æ—à–µ–ª –º–∏–º–æ. +5 –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è, +10 –∏–Ω—Ü–µ–ª—å–Ω–æ—Å—Ç–∏, +5 –∫–æ–º–ø–ª–µ–∫—Å–∞ –±–æ–≥–∞</span>`;
                }
            } else if (rand < 35) {
                // –î—Ä–∞–∫–∞ –≤ –º–µ—Ç—Ä–æ (5%)
                changeStat('health', -15);
                changeStat('mood', -10);
                changeStat('incel', 20);
                changeStat('godComplex', -15);
                logText += `<br><span style="color: #ff4444;">üí• –í –≤–∞–≥–æ–Ω–µ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –¥—Ä–∞–∫–∞, –∏ –ú–∞—Ç–≤–µ–π —Å–ª—É—á–∞–π–Ω–æ –ø–æ–ª—É—á–∏–ª –ø–æ –ª–∏—Ü—É. –†–µ–∞–ª—å–Ω–æ—Å—Ç—å –±—å–µ—Ç –±–æ–ª—å–Ω–æ. -15 –∑–¥–æ—Ä–æ–≤—å—è, -10 –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è, +20 –∏–Ω—Ü–µ–ª—å–Ω–æ—Å—Ç–∏, -15 –∫–æ–º–ø–ª–µ–∫—Å–∞ –±–æ–≥–∞</span>`;
            } else if (rand < 42) {
                // –ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π —Ä–∞–∑–≥–æ–≤–æ—Ä (7%)
                changeStat('mood', 15);
                changeStat('adequacy', 10);
                changeStat('godComplex', -10);
                changeStat('incel', -10);
                logText += `<br><span style="color: #44ff44;">üí¨ –ú–∞—Ç–≤–µ–π —Å–ª—É—á–∞–π–Ω–æ —É—Å–ª—ã—à–∞–ª –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π —Ä–∞–∑–≥–æ–≤–æ—Ä. –ù–µ–º–Ω–æ–≥–æ –≤–µ—Ä–Ω—É–ª–∞—Å—å –≤–µ—Ä–∞ –≤ –ª—é–¥–µ–π. +15 –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è, +10 –∞–¥–µ–∫–≤–∞—Ç–Ω–æ—Å—Ç–∏, -10 –∫–æ–º–ø–ª–µ–∫—Å–∞ –±–æ–≥–∞, -10 –∏–Ω—Ü–µ–ª—å–Ω–æ—Å—Ç–∏</span>`;
            } else if (rand < 50) {
                // –ë–æ–º–∂–∏ –≤ –ø–µ—Ä–µ—Ö–æ–¥–µ (8%)
                changeStat('mood', -5);
                changeStat('adequacy', 5);
                changeStat('godComplex', -10);
                logText += `<br><span style="color: #ffaa00;">üèöÔ∏è –í–∏–¥–µ–ª –±–æ–º–∂–µ–π –≤ –ø–µ—Ä–µ—Ö–æ–¥–µ. –ü–æ–Ω—è–ª, —á—Ç–æ –µ–≥–æ –∂–∏–∑–Ω—å –µ—â–µ –Ω–µ —Ç–∞–∫ –ø–ª–æ—Ö–∞. -5 –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è, +5 –∞–¥–µ–∫–≤–∞—Ç–Ω–æ—Å—Ç–∏, -10 –∫–æ–º–ø–ª–µ–∫—Å–∞ –±–æ–≥–∞</span>`;
            }
            
            addLog(logText, 'event');
            hapticFeedback('medium');
            saveGameThrottled();
            checkAchievementsProgress();
            updateUI();
            checkGameOver();
        }

        // –°–æ–Ω –∏ –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å
        function sleep() {
            // CRITICAL: Day degradation happens HERE
            gameState.day++;
            gameState.parentFoodToday = 0;
            gameState.hospitalToday = false;
            gameState.stats.daysWithoutOutside++;
            
            // Track debt days
            if (gameState.money < 0) {
                gameState.daysInDebt++;
                gameState.stats.wasInDebt = true;
                if (gameState.daysInDebt > gameState.stats.maxDebtDays) {
                    gameState.stats.maxDebtDays = gameState.daysInDebt;
                }
            } else {
                gameState.daysInDebt = 0; // Reset if positive balance
            }
            
            // DEGRADATION - stats decrease daily (REBALANCED)
            changeStat('health', -2);
            changeStat('mood', -5);  // Increased from -3
            changeStat('satiety', -20);
            changeStat('adequacy', -2);  // Increased from -1
            changeStat('incel', 3);  // Increased from 2
            
            // Fatigue recovery
            const oldFatigue = gameState.fatigue;
            gameState.fatigue = Math.floor(gameState.fatigue / 2);
            
            // Check depression AFTER daily changes (mood < 20, not < 0)
            if (gameState.mood < 20) {
                gameState.daysInDepression++;
                gameState.vikaRelationship = Math.max(0, gameState.vikaRelationship - 10);
                
                if (gameState.daysInDepression >= 3) {
                    // Suicide attempt (50% chance)
                    const success = Math.random() < 0.5;
                    gameState.stats.suicideAttempts++;
                    
                    if (success) {
                        // Game over
                        hapticFeedback('error');
                        document.getElementById('gameOverReason').textContent = '–ú–∞—Ç–≤–µ–π –Ω–µ –≤—ã–¥–µ—Ä–∂–∞–ª —Ç—Ä—ë—Ö –¥–Ω–µ–π –¥–µ–ø—Ä–µ—Å—Å–∏–∏ –∏ –ø–æ–≤–µ—Å–∏–ª—Å—è –∏–∑-–∑–∞ –±–µ–∑–æ—Ç–≤–µ—Ç–Ω–æ–π –ª—é–±–≤–∏ –∫ –í–∏–∫–µ. üíÄ';
                        document.getElementById('finalDays').textContent = gameState.day;
                        document.getElementById('gameOverModal').style.display = 'flex';
                        if (isTelegram && tg) {
                            tg.MainButton.hide();
                        }
                        return;
                    } else {
                        // Failed attempt - survived!
                        gameState.mood = 30;
                        changeStat('health', -30);
                        gameState.daysInDepression = 0;
                        addLog(`<strong>üíÄ –ü–æ–ø—ã—Ç–∫–∞ —Å—É–∏—Ü–∏–¥–∞</strong><br>–ü–æ—Å–ª–µ 3 –¥–Ω–µ–π –¥–µ–ø—Ä–µ—Å—Å–∏–∏ –ú–∞—Ç–≤–µ–π –ø–æ–ø—ã—Ç–∞–ª—Å—è –ø–æ–≤–µ—Å–∏—Ç—å—Å—è... –ù–æ –≤–µ—Ä—ë–≤–∫–∞ –ø–æ—Ä–≤–∞–ª–∞—Å—å! –†–æ–¥–∏—Ç–µ–ª–∏ –Ω–∞—à–ª–∏ –µ–≥–æ –∏ –≤—ã–∑–≤–∞–ª–∏ —Å–∫–æ—Ä—É—é. –í—Ç–æ—Ä–æ–π —à–∞–Ω—Å –Ω–∞ –∂–∏–∑–Ω—å. –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ: 30, -30 –∑–¥–æ—Ä–æ–≤—å—è.`, 'danger');
                        checkAchievementsProgress();
                    }
                } else if (gameState.daysInDepression === 1) {
                    addLog(`<strong>‚ö†Ô∏è –î–µ–ø—Ä–µ—Å—Å–∏—è: 1/3 –¥–Ω—è</strong><br>–ú–∞—Ç–≤–µ–π —á—É–≤—Å—Ç–≤—É–µ—Ç —Å–µ–±—è —É–∂–∞—Å–Ω–æ. -10 –æ—Ç–Ω–æ—à–µ–Ω–∏–π —Å –í–∏–∫–æ–π. –ï—â–µ 2 –¥–Ω—è —Å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ–º <20 - –∏ –±—É–¥–µ—Ç –±–µ–¥–∞!`, 'danger');
                } else if (gameState.daysInDepression === 2) {
                    addLog(`<strong>‚ö†Ô∏è –û–ü–ê–°–ù–û! –î–µ–ø—Ä–µ—Å—Å–∏—è: 2/3 –¥–Ω—è</strong><br>–ú–∞—Ç–≤–µ–π –Ω–∞ –≥—Ä–∞–Ω–∏... -10 –æ—Ç–Ω–æ—à–µ–Ω–∏–π —Å –í–∏–∫–æ–π. –ï—â–µ –æ–¥–∏–Ω –¥–µ–Ω—å —Å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ–º <20 - –ø–æ–ø—ã—Ç–∫–∞ —Å—É–∏—Ü–∏–¥–∞!`, 'danger');
                }
            } else {
                gameState.daysInDepression = 0;
            }
            
            if (oldFatigue > 0) {
                addLog(`<strong>üí§ –î–µ–Ω—å ${gameState.day}</strong><br>–ú–∞—Ç–≤–µ–π –ø–æ—Å–ø–∞–ª. –£—Å—Ç–∞–ª–æ—Å—Ç—å: ${oldFatigue} ‚Üí ${gameState.fatigue}. –î–µ–≥—Ä–∞–¥–∞—Ü–∏—è: -2 –∑–¥–æ—Ä–æ–≤—å—è, -3 –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è, -20 —Å—ã—Ç–æ—Å—Ç–∏, -1 –∞–¥–µ–∫–≤–∞—Ç–Ω–æ—Å—Ç–∏, +2 –∏–Ω—Ü–µ–ª—å–Ω–æ—Å—Ç–∏.`, 'event');
            } else {
                addLog(`<strong>üí§ –î–µ–Ω—å ${gameState.day}</strong><br>–ù–æ–≤—ã–π –¥–µ–Ω—å. –î–µ–≥—Ä–∞–¥–∞—Ü–∏—è: -2 –∑–¥–æ—Ä–æ–≤—å—è, -3 –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è, -20 —Å—ã—Ç–æ—Å—Ç–∏.`, 'event');
            }
            
            // –°–ª—É—á–∞–π–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è (–ñ–ö–•, –≥–æ–ø–Ω–∏–∫–∏)
            checkRandomEvents();
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ–ª–æ–¥–∞
            if (gameState.satiety <= 0) {
                gameState.satietyZeroDays++;
                if (gameState.satietyZeroDays >= 1) {
                    addLog(`<strong>‚ö†Ô∏è –ì–û–õ–û–î!</strong><br>–ú–∞—Ç–≤–µ–π –≥–æ–ª–æ–¥–∞–µ—Ç —É–∂–µ ${gameState.satietyZeroDays} –¥–µ–Ω—å(–¥–Ω—è). –ü—Ä–∏ 3 –¥–Ω—è—Ö - —Å–º–µ—Ä—Ç—å!`, 'danger');
                }
            } else {
                gameState.satietyZeroDays = 0;
            }
            
            // Debt warnings
            if (gameState.money < 0) {
                if (gameState.daysInDebt === 1) {
                    addLog(`<strong>‚ö†Ô∏è –¢—ã –≤ –¥–æ–ª–≥–∞—Ö</strong><br>–ë–∞–ª–∞–Ω—Å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π. –ï—Å–ª–∏ –Ω–µ –ø–æ–≥–∞—Å–∏—à—å –¥–æ–ª–≥ –∑–∞ 7 –¥–Ω–µ–π - –∫–æ–ª–ª–µ–∫—Ç–æ—Ä—ã –ø—Ä–∏–¥—É—Ç!`, 'danger');
                } else if (gameState.daysInDebt >= 2 && gameState.daysInDebt <= 3) {
                    addLog(`<strong>‚ö†Ô∏è –¢—ã –≤ –¥–æ–ª–≥–∞—Ö</strong><br>–î–µ–Ω—å ${gameState.daysInDebt}/7 —Å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º –±–∞–ª–∞–Ω—Å–æ–º. –ù—É–∂–Ω–æ —Å—Ä–æ—á–Ω–æ –∑–∞—Ä–∞–±–æ—Ç–∞—Ç—å!`, 'danger');
                } else if (gameState.daysInDebt >= 4 && gameState.daysInDebt <= 5) {
                    addLog(`<strong>‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï! –î–æ–ª–≥ —É–∂–µ ${gameState.daysInDebt} –¥–Ω–µ–π!</strong><br>–û—Å—Ç–∞–ª–æ—Å—å ${7 - gameState.daysInDebt} –¥–Ω—è –¥–æ –≤–∏–∑–∏—Ç–∞ –∫–æ–ª–ª–µ–∫—Ç–æ—Ä–æ–≤!`, 'danger');
                } else if (gameState.daysInDebt === 6) {
                    addLog(`<strong>üö® –ö–†–ò–¢–ò–ß–ù–û! –ï—â–µ 1 –¥–µ–Ω—å –∏ –∫–æ–ª–ª–µ–∫—Ç–æ—Ä—ã!</strong><br>–°–†–û–ß–ù–û –Ω—É–∂–Ω—ã –¥–µ–Ω—å–≥–∏! –ë–∞–ª–∞–Ω—Å: ${gameState.money.toLocaleString('ru-RU')}‚ÇΩ`, 'danger');
                }
            }
            
            hapticFeedback('medium');
            saveGame(); // Full save on sleep
            updateUI();
            checkGameOver();
        }

        // –°–ª—É—á–∞–π–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
        function checkRandomEvents() {
            // –ñ–ö–• –∫–∞–∂–¥—ã–π 7-–π –¥–µ–Ω—å - CRITICAL: ALWAYS deducts, can go negative!
            if (gameState.day % 7 === 0) {
                gameState.money -= 5000; // Always deduct, even if negative
                // DO NOT use Math.max here - balance CAN be negative!
                
                if (gameState.money < 0) {
                    addLog(`<strong style="color: #ff6600; font-size: 1.2em;">‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï! –ü–†–ò–®–ï–õ –°–ß–ï–¢ –ó–ê –ñ–ö–•!</strong><br>–°–ø–∏—Å–∞–Ω–æ 5,000‚ÇΩ –∑–∞ –∫–≤–∞—Ä—Ç–∏—Ä—É. –ë–∞–ª–∞–Ω—Å: ${gameState.money.toLocaleString('ru-RU')}‚ÇΩ <span style="color: #ff4444; font-weight: bold;">(–î–û–õ–ì!)</span>`, 'danger');
                } else {
                    addLog(`<strong style="color: #ff6600; font-size: 1.2em;">‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï! –ü–†–ò–®–ï–õ –°–ß–ï–¢ –ó–ê –ñ–ö–•!</strong><br>–°–ø–∏—Å–∞–Ω–æ 5,000‚ÇΩ –∑–∞ –∫–≤–∞—Ä—Ç–∏—Ä—É. –û—Å—Ç–∞–ª–æ—Å—å: ${gameState.money.toLocaleString('ru-RU')}‚ÇΩ`, 'danger');
                }
            }
            
            // –ì–æ–ø–Ω–∏–∫–∏ (20% —à–∞–Ω—Å) - CRITICAL FIX: Alternative punishment!
            if (Math.random() < 0.20) {
                const moneyLoss = Math.floor(Math.random() * 2500) + 500;
                const healthLoss = Math.floor(Math.random() * 15) + 5;
                
                if (gameState.money >= moneyLoss) {
                    // Has money - rob normally
                    gameState.money -= moneyLoss;
                    changeStat('health', -healthLoss);
                    changeStat('incel', 10);
                    changeStat('adequacy', -5);
                    addLog(`<strong>‚ö†Ô∏è –ì–æ–ø–Ω–∏–∫–∏!</strong><br>–ù–∞ —Ç–µ–±—è –Ω–∞–ø–∞–ª–∏ –≥–æ–ø–Ω–∏–∫–∏ –ø–æ –¥–æ—Ä–æ–≥–µ –¥–æ–º–æ–π. –û—Ç–æ–±—Ä–∞–ª–∏ ${moneyLoss.toLocaleString('ru-RU')}‚ÇΩ –∏ –Ω–∞–¥–∞–≤–∞–ª–∏ –ø–æ –ø–æ—á–∫–∞–º. -${healthLoss} –∑–¥–æ—Ä–æ–≤—å—è, +10 –∏–Ω—Ü–µ–ª—å–Ω–æ—Å—Ç–∏, -5 –∞–¥–µ–∫–≤–∞—Ç–Ω–æ—Å—Ç–∏. –û—Å—Ç–∞–ª–æ—Å—å: ${gameState.money.toLocaleString('ru-RU')}‚ÇΩ`, 'danger');
                } else {
                    // No money - beat harder!
                    const extraDamage = Math.floor(moneyLoss / 100);  // Convert money to damage
                    const totalHealthLoss = healthLoss + extraDamage;
                    const moodLoss = 20;
                    
                    gameState.money -= moneyLoss;  // Goes into debt!
                    changeStat('health', -totalHealthLoss);
                    changeStat('mood', -moodLoss);
                    changeStat('incel', 15);
                    changeStat('adequacy', -10);
                    
                    addLog(`<strong style="color: #ff0000;">üö® –ì–û–ü–ù–ò–ö–ò - –ù–ï–¢ –î–ï–ù–ï–ì!</strong><br>–ì–æ–ø–Ω–∏–∫–∏ –Ω–µ –Ω–∞—à–ª–∏ –¥–µ–Ω–µ–≥ –∏ –ñ–ï–°–¢–ö–û –∏–∑–±–∏–ª–∏! -${totalHealthLoss} –∑–¥–æ—Ä–æ–≤—å—è, -${moodLoss} –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è, +15 –∏–Ω—Ü–µ–ª—å–Ω–æ—Å—Ç–∏, -10 –∞–¥–µ–∫–≤–∞—Ç–Ω–æ—Å—Ç–∏. –î–æ–ª–≥: ${gameState.money.toLocaleString('ru-RU')}‚ÇΩ`, 'danger');
                }
            }
            
            // –î—Ä—É–≥–∏–µ —Å–ª—É—á–∞–π–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
            if (Math.random() < 0.15) {
                const randomEvents = [
                    { 
                        text: '–ù–∞—à—ë–ª 500‚ÇΩ –Ω–∞ —É–ª–∏—Ü–µ! –£–¥–∞—á–∞ —É–ª—ã–±–Ω—É–ª–∞—Å—å.', 
                        effect: () => { gameState.money += 500; }
                    },
                    { 
                        text: '–£–≤–∏–¥–µ–ª –±—ã–≤—à—É—é —Å –Ω–æ–≤—ã–º –ø–∞—Ä–Ω–µ–º. –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –≤ –º–∏–Ω—É—Å.', 
                        effect: () => { changeStat('mood', -15); changeStat('incel', 10); }
                    },
                    { 
                        text: '–°–ª—É—á–∞–π–Ω–æ –≤—Å—Ç—Ä–µ—Ç–∏–ª —Å—Ç–∞—Ä–æ–≥–æ –¥—Ä—É–≥–∞. –ü–æ–±–æ–ª—Ç–∞–ª–∏, —Å—Ç–∞–ª–æ –ª–µ–≥—á–µ.', 
                        effect: () => { changeStat('mood', 10); changeStat('adequacy', 5); }
                    },
                    { 
                        text: '–ü–æ–π–º–∞–ª –ø—Ä–æ—Å—Ç—É–¥—É. –ù–æ—Å —Ç–µ—á—ë—Ç, –≥–æ–ª–æ–≤–∞ –±–æ–ª–∏—Ç.', 
                        effect: () => { changeStat('health', -10); }
                    }
                ];
                
                const event = randomEvents[Math.floor(Math.random() * randomEvents.length)];
                event.effect();
                addLog(`<strong>üé≤ –°–æ–±—ã—Ç–∏–µ</strong><br>${event.text}`, 'event');
            }
        }

        // –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è - –ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫
        const ALL_ACHIEVEMENTS = {
            survival: [
                { id: 'day7', title: 'üéñÔ∏è –ù–µ–¥–µ–ª—è', desc: '–ü—Ä–æ–∂–∏–ª 7 –¥–Ω–µ–π', check: () => gameState.day === 7 },
                { id: 'day14', title: 'üéñÔ∏è –î–≤–µ –Ω–µ–¥–µ–ª–∏', desc: '–ü—Ä–æ–∂–∏–ª 14 –¥–Ω–µ–π', check: () => gameState.day === 14 },
                { id: 'day21', title: 'üéñÔ∏è –¢—Ä–∏ –Ω–µ–¥–µ–ª–∏', desc: '–ü—Ä–æ–∂–∏–ª 21 –¥–µ–Ω—å', check: () => gameState.day === 21 },
                { id: 'day30', title: 'üéñÔ∏è –ú–µ—Å—è—Ü', desc: '–ü—Ä–æ–∂–∏–ª 30 –¥–Ω–µ–π', check: () => gameState.day === 30 },
                { id: 'day50', title: 'üéñÔ∏è 50 –¥–Ω–µ–π', desc: '–ü—Ä–æ–∂–∏–ª 50 –¥–Ω–µ–π', check: () => gameState.day === 50 },
                { id: 'day100', title: 'üéñÔ∏è –õ–µ–≥–µ–Ω–¥–∞', desc: '–ü—Ä–æ–∂–∏–ª 100 –¥–Ω–µ–π!', check: () => gameState.day === 100 }
            ],
            relationships: [
                { id: 'firstCall', title: 'üìû –ü–µ—Ä–≤—ã–π –∑–≤–æ–Ω–æ–∫', desc: '–ü–æ–∑–≤–æ–Ω–∏–ª –í–∏–∫–µ –ø–µ—Ä–≤—ã–π —Ä–∞–∑', check: () => (gameState.stats.vikaCallsSuccess + gameState.stats.vikaCallsFail) === 1 },
                { id: 'successDate', title: 'üíñ –£–¥–∞—á–Ω–æ–µ —Å–≤–∏–¥–∞–Ω–∏–µ', desc: '–£—Å–ø–µ—à–Ω—ã–π –∑–≤–æ–Ω–æ–∫ –í–∏–∫–µ', check: () => gameState.stats.vikaCallsSuccess >= 1 },
                { id: 'persistent', title: 'üí™ –ù–∞—Å—Ç–æ–π—á–∏–≤—ã–π', desc: '5 —É—Å–ø–µ—à–Ω—ã—Ö –∑–≤–æ–Ω–∫–æ–≤', check: () => gameState.stats.vikaCallsSuccess >= 5 },
                { id: 'simp', title: 'üí∏ –°–∏–º–ø', desc: '–ü–æ—Ç—Ä–∞—Ç–∏–ª 50,000‚ÇΩ –Ω–∞ –í–∏–∫—É', check: () => gameState.stats.vikaMoneySpent >= 50000 },
                { id: 'vikaLove50', title: 'üíï –°–∏–º–ø–∞—Ç–∏—è', desc: '–û—Ç–Ω–æ—à–µ–Ω–∏—è —Å –í–∏–∫–æ–π 50+', check: () => gameState.vikaRelationship >= 50 },
                { id: 'vikaLove100', title: 'üíñ –õ—é–±–æ–≤—å –í–∏–∫–∏', desc: '–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è (100/100)', check: () => gameState.vikaRelationship >= 100 }
            ],
            degradation: [
                { id: 'firstPost', title: 'üì± –ü–µ—Ä–≤—ã–π –ø–æ—Å—Ç', desc: '–ó–∞–ø–æ—Å—Ç–∏–ª –≤ –ê–Ø–ï–ß', check: () => gameState.stats.postsCount === 1 },
                { id: 'activePoster', title: 'üî• –ê–∫—Ç–∏–≤–∏—Å—Ç –ê–Ø–ï–ß', desc: '10 –ø–æ—Å—Ç–æ–≤', check: () => gameState.stats.postsCount >= 10 },
                { id: 'trashKing', title: 'üóëÔ∏è –ö–æ—Ä–æ–ª—å –ø–æ–º–æ–π–∫–∏', desc: '–ü–æ–µ–ª –∏–∑ –ø–æ–º–æ–π–∫–∏ 5 —Ä–∞–∑', check: () => gameState.stats.trashMeals >= 5 },
                { id: 'dickpicMaster', title: 'üçÜ –î–∏–∫–ø–∏–∫ –º–∞—Å—Ç–µ—Ä', desc: '–°—Ñ–æ—Ç–∫–∞–ª –ø–µ–Ω–∏—Å 3 —Ä–∞–∑–∞', check: () => gameState.stats.dickPics >= 3 },
                { id: 'maxIncel', title: 'ü§° –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –∏–Ω—Ü–µ–ª—å–Ω–æ—Å—Ç—å', desc: '–ò–Ω—Ü–µ–ª—å–Ω–æ—Å—Ç—å 100', check: () => gameState.incel >= 100 }
            ],
            debt: [
                { id: 'inDebt', title: 'üí∏ –í –¥–æ–ª–≥–∞—Ö', desc: '–í–ø–µ—Ä–≤—ã–µ —É—à–µ–ª –≤ –º–∏–Ω—É—Å', check: () => gameState.money < 0 },
                { id: 'debtEscape', title: 'üí∞ –í—ã–±—Ä–∞–ª—Å—è –∏–∑ –¥–æ–ª–≥–æ–≤', desc: '–í–µ—Ä–Ω—É–ª—Å—è –∏–∑ –º–∏–Ω—É—Å–∞ –≤ –ø–ª—é—Å', check: () => gameState.money >= 0 && gameState.stats.wasInDebt },
                { id: 'bankrupt2', title: 'üö´ –ë–∞–Ω–∫—Ä–æ—Ç', desc: '–î–æ–ª–≥ –¥–æ—Å—Ç–∏–≥ -20,000‚ÇΩ', check: () => gameState.money <= -20000 },
                { id: 'onEdge', title: '‚ö†Ô∏è –ù–∞ –≥—Ä–∞–Ω–∏', desc: '–î–æ–∂–∏–ª –¥–æ 6 –¥–Ω–µ–π –≤ –¥–æ–ª–≥—É –∏ –≤—ã–±—Ä–∞–ª—Å—è', check: () => gameState.money >= 0 && gameState.stats.maxDebtDays >= 6 }
            ],
            health: [
                { id: 'firstHospital', title: 'üè• –ü–µ—Ä–≤—ã–π –≤–∏–∑–∏—Ç', desc: '–°—Ö–æ–¥–∏–ª –≤ –±–æ–ª—å–Ω–∏—Ü—É', check: () => gameState.stats.hospitalVisits === 1 },
                { id: 'regularPatient', title: 'ü©∫ –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–π –ø–∞—Ü–∏–µ–Ω—Ç', desc: '5 –≤–∏–∑–∏—Ç–æ–≤ –≤ –±–æ–ª—å–Ω–∏—Ü—É', check: () => gameState.stats.hospitalVisits >= 5 },
                { id: 'survivor', title: 'üí™ –í—ã–∂–∏–≤—à–∏–π', desc: '–ü–µ—Ä–µ–∂–∏–ª –ø–æ–ø—ã—Ç–∫—É —Å—É–∏—Ü–∏–¥–∞', check: () => gameState.stats.suicideAttempts >= 1 },
                { id: 'willpower', title: 'üß† –°–∏–ª–∞ –≤–æ–ª–∏', desc: '–ê–¥–µ–∫–≤–∞—Ç–Ω–æ—Å—Ç—å 80+', check: () => gameState.adequacy >= 80 }
            ],
            work: [
                { id: 'firstShift', title: 'üõ†Ô∏è –ü–µ—Ä–≤–∞—è —Å–º–µ–Ω–∞', desc: '–ü–æ—Ä–∞–±–æ—Ç–∞–ª –ø–µ—Ä–≤—ã–π —Ä–∞–∑', check: () => gameState.stats.workShifts === 1 },
                { id: 'hardWorker', title: 'üíº –¢—Ä—É–¥—è–≥–∞', desc: '10 —Å–º–µ–Ω –Ω–∞ —Ä–∞–±–æ—Ç–µ', check: () => gameState.stats.workShifts >= 10 },
                { id: 'rich', title: 'üí∞ –ë–æ–≥–∞—Ç—ã–π', desc: '–ù–∞–∫–æ–ø–∏–ª 50,000‚ÇΩ', check: () => gameState.money >= 50000 },
                { id: 'bankrupt', title: 'üö´ –ë–∞–Ω–∫—Ä–æ—Ç', desc: '–î–µ–Ω—å–≥–∏ —É–ø–∞–ª–∏ –¥–æ 0', check: () => gameState.money <= 0 && gameState.day > 1 }
            ],
            metro: [
                { id: 'firstMetro', title: 'üöá –ü–µ—Ä–≤–∞—è –ø–æ–µ–∑–¥–∫–∞', desc: '–ü—Ä–æ–∫–∞—Ç–∏–ª—Å—è –≤ –º–µ—Ç—Ä–æ', check: () => gameState.stats.metroRides === 1 },
                { id: 'passenger', title: 'üé´ –ü–∞—Å—Å–∞–∂–∏—Ä', desc: '10 –ø–æ–µ–∑–¥–æ–∫ –≤ –º–µ—Ç—Ä–æ', check: () => gameState.stats.metroRides >= 10 },
                { id: 'metroRegular', title: 'üöá –ó–∞–≤—Å–µ–≥–¥–∞—Ç–∞–π –º–µ—Ç—Ä–æ', desc: '50 –ø–æ–µ–∑–¥–æ–∫', check: () => gameState.stats.metroRides >= 50 },
                { id: 'fined', title: 'üö® –®—Ç—Ä–∞—Ñ–Ω–∏–∫', desc: '–ü–æ–ø–∞–ª—Å—è –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä–∞–º', check: () => gameState.stats.metroFined >= 1 },
                { id: 'godSlayer', title: 'üëë –£–±–∏–π—Ü–∞ –ë–æ–≥–∞', desc: '–°–Ω–∏–∑–∏–ª –∫–æ–º–ø–ª–µ–∫—Å –±–æ–≥–∞ –º–µ—Ç—Ä–æ —Å 100+', check: () => gameState.godComplex < 50 && gameState.stats.metroRides >= 3 }
            ],
            lifestyle: [
                { id: 'clean', title: 'üöø –ß–∏—Å—Ç—é–ª—è', desc: '–ü–æ–º—ã–ª—Å—è 10 —Ä–∞–∑', check: () => gameState.stats.washCount >= 10 },
                { id: 'stylish', title: 'üßî –ú–æ–¥–Ω–∏–∫', desc: '–ü–æ–±—Ä–∏–ª—Å—è 10 —Ä–∞–∑', check: () => gameState.stats.shaveCount >= 10 },
                { id: 'hermit', title: 'üè† –°–æ—Ü–∏–æ—Ñ–æ–±', desc: '–ù–µ –≤—ã—Ö–æ–¥–∏–ª –∏–∑ –¥–æ–º–∞ 7 –¥–Ω–µ–π', check: () => gameState.stats.daysWithoutOutside >= 7 },
                { id: 'social', title: 'üö∂ –ì—É–ª—è–∫–∞', desc: '–í—ã—Ö–æ–¥–∏–ª –∏–∑ –¥–æ–º–∞ 10 —Ä–∞–∑', check: () => gameState.stats.outsideCount >= 10 }
            ]
        };

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
        function checkAchievementsProgress() {
            Object.keys(ALL_ACHIEVEMENTS).forEach(category => {
                ALL_ACHIEVEMENTS[category].forEach(ach => {
                    if (!gameState.achievements.includes(ach.id) && ach.check()) {
                        gameState.achievements.push(ach.id);
                        addLog(`<strong>üèÜ –î–û–°–¢–ò–ñ–ï–ù–ò–ï!</strong><br>${ach.title}: ${ach.desc}`, 'event');
                        updateAchievementsDisplay();
                    }
                });
            });
        }

        function updateAchievementsDisplay() {
            const container = document.getElementById('achievementsList');
            container.innerHTML = '';
            
            // Show first 3 unlocked or next to unlock
            let shown = 0;
            Object.keys(ALL_ACHIEVEMENTS).forEach(category => {
                ALL_ACHIEVEMENTS[category].forEach(ach => {
                    if (shown < 3) {
                        const isUnlocked = gameState.achievements.includes(ach.id);
                        const div = document.createElement('div');
                        div.className = 'achievement' + (isUnlocked ? '' : ' locked');
                        div.textContent = ach.title;
                        container.appendChild(div);
                        shown++;
                    }
                });
            });
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π Game Over
        function checkGameOver() {
            let gameOver = false;
            let reason = '';
            
            if (gameState.health <= 0) {
                gameOver = true;
                reason = '–¢–≤–æ—ë –∑–¥–æ—Ä–æ–≤—å–µ –æ–ø—É—Å—Ç–∏–ª–æ—Å—å –¥–æ –Ω—É–ª—è. –û—Ä–≥–∞–Ω–∏–∑–º –Ω–µ –≤—ã–¥–µ—Ä–∂–∞–ª...';
            } else if (gameState.satietyZeroDays >= 3) {
                gameOver = true;
                reason = '–¢—ã –Ω–µ –µ–ª —É–∂–µ 3 –¥–Ω—è. –ì–æ–ª–æ–¥–Ω–∞—è —Å–º–µ—Ä—Ç—å –Ω–∞—Å—Ç–∏–≥–ª–∞ —Ç–µ–±—è...';
            } else if (gameState.godComplex >= 100) {
                gameOver = true;
                reason = '–ö–æ–º–ø–ª–µ–∫—Å –ë–æ–≥–∞ –¥–æ—Å—Ç–∏–≥ –º–∞–∫—Å–∏–º—É–º–∞. –¢—ã –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ –æ—Ç–æ—Ä–≤–∞–ª—Å—è –æ—Ç —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏...';
            } else if (gameState.daysInDebt >= 7) {
                gameOver = true;
                reason = '–ú–∞—Ç–≤–µ–π –Ω–µ —Å–º–æ–≥ –≤—ã–ø–ª–∞—Ç–∏—Ç—å –¥–æ–ª–≥–∏. –ö–æ–ª–ª–µ–∫—Ç–æ—Ä—ã –ø—Ä–∏—à–ª–∏... üíÄ';
            }
            
            // Show warnings for critical states
            if (gameState.mood < 20 && Math.random() < 0.3) {
                addLog(`<strong>üí° –°–æ–≤–µ—Ç</strong><br>‚ö†Ô∏è –î–ï–ü–†–ï–°–°–ò–Ø! –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –Ω–∏–∑–∫–æ–µ! –ü–æ–ø—Ä–æ–±—É–π: –ø–æ–¥—Ä–æ—á–∏—Ç—å (+10), –∑–∞–∫–∞–∑–∞—Ç—å –ú–∞–º–±—É (+40), –∏–ª–∏ –ø–æ—Å—Ç–∏—Ç—å –≤ –ê–Ø–ï–ß (+10).`, 'event');
            }
            if (gameState.godComplex > 70 && Math.random() < 0.3) {
                addLog(`<strong>‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ!</strong><br>–≠–ì–û –Ω–∞ –ø—Ä–µ–¥–µ–ª–µ! –ö–æ–º–ø–ª–µ–∫—Å –±–æ–≥–∞: ${Math.round(gameState.godComplex)}/100. –ü—Ä–∏ 100 - game over!`, 'danger');
            }
            if (gameState.adequacy < 20 && Math.random() < 0.3) {
                addLog(`<strong>‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ!</strong><br>–¢—ã —Å–æ–≤—Å–µ–º –ø–æ–µ—Ö–∞–ª! –ê–¥–µ–∫–≤–∞—Ç–Ω–æ—Å—Ç—å: ${Math.round(gameState.adequacy)}/100.`, 'danger');
            }
            
            if (gameOver) {
                hapticFeedback('error');
                document.getElementById('gameOverReason').textContent = reason;
                document.getElementById('finalDays').textContent = gameState.day;
                document.getElementById('gameOverModal').style.display = 'flex';
                if (isTelegram && tg) {
                    tg.MainButton.hide();
                }
            }
        }

        // Toast notification function
        function showWelcomeToast() {
            const toast = document.getElementById('welcome-toast');
            if (!toast) return;
            
            // Show toast
            toast.classList.remove('hidden');
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                toast.classList.add('fade-out');
                
                // Fully remove after animation
                setTimeout(() => {
                    toast.classList.add('hidden');
                    toast.classList.remove('fade-out');
                }, 500);
            }, 5000);
        }

        // UI functions for modals
        function closeTutorial() {
            document.getElementById('tutorialModal').style.display = 'none';
            tutorialClosed = true;
            
            // Show welcome toast after closing tutorial
            setTimeout(() => {
                showWelcomeToast();
            }, 300);
        }

        function showAchievements() {
            const container = document.getElementById('achievementsFullList');
            let html = '';
            
            const categoryNames = {
                survival: 'üéñÔ∏è –í—ã–∂–∏–≤–∞–Ω–∏–µ',
                relationships: 'üíñ –û—Ç–Ω–æ—à–µ–Ω–∏—è',
                degradation: 'ü§° –î–µ–≥—Ä–∞–¥–∞—Ü–∏—è',
                health: '‚ù§Ô∏è –ó–¥–æ—Ä–æ–≤—å–µ',
                work: 'üíº –†–∞–±–æ—Ç–∞',
                metro: 'üöá –ú–µ—Ç—Ä–æ',
                lifestyle: 'üè† –û–±—Ä–∞–∑ –∂–∏–∑–Ω–∏',
                debt: 'üí∏ –î–æ–ª–≥–∏'
            };
            
            Object.keys(ALL_ACHIEVEMENTS).forEach(category => {
                html += `<h3 style="color: var(--color-primary); margin-top: 20px;">${categoryNames[category]}</h3>`;
                ALL_ACHIEVEMENTS[category].forEach(ach => {
                    const isUnlocked = gameState.achievements.includes(ach.id);
                    const style = isUnlocked ? 'color: var(--color-warning); font-weight: bold;' : 'color: var(--color-text-dim);';
                    const icon = isUnlocked ? '‚úÖ' : 'üîí';
                    html += `<p style="${style}">${icon} ${ach.title} - ${ach.desc}</p>`;
                });
            });
            
            const unlockedCount = gameState.achievements.length;
            const totalCount = Object.values(ALL_ACHIEVEMENTS).reduce((sum, cat) => sum + cat.length, 0);
            html = `<p style="text-align: center; font-size: 1.2em; margin-bottom: 20px;">–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ: <strong>${unlockedCount}/${totalCount}</strong></p>` + html;
            
            container.innerHTML = html;
            document.getElementById('achievementsModal').style.display = 'flex';
        }

        function closeAchievements() {
            document.getElementById('achievementsModal').style.display = 'none';
        }

        function showStatistics() {
            const s = gameState.stats;
            const html = `
                <p><strong>üìÖ –î–Ω–µ–π –ø—Ä–æ–∂–∏—Ç–æ:</strong> ${gameState.day}</p>
                <p><strong>üí∞ –í—Å–µ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ:</strong> ${s.totalMoneyEarned.toLocaleString('ru-RU')}‚ÇΩ</p>
                <p><strong>üíº –†–∞–±–æ—á–∏—Ö —Å–º–µ–Ω:</strong> ${s.workShifts}</p>
                <p><strong>üíñ –û—Ç–Ω–æ—à–µ–Ω–∏—è —Å –í–∏–∫–æ–π:</strong> ${Math.round(gameState.vikaRelationship)}/100</p>
                <p><strong>üìû –ó–≤–æ–Ω–∫–æ–≤ –í–∏–∫–µ (—É—Å–ø–µ—à–Ω—ã—Ö):</strong> ${s.vikaCallsSuccess}</p>
                <p><strong>üö´ –ó–≤–æ–Ω–∫–æ–≤ –í–∏–∫–µ (–æ—Ç–∫–∞–∑–æ–≤):</strong> ${s.vikaCallsFail}</p>
                <p><strong>üí∏ –ü–æ—Ç—Ä–∞—á–µ–Ω–æ –Ω–∞ –í–∏–∫—É:</strong> ${s.vikaMoneySpent.toLocaleString('ru-RU')}‚ÇΩ</p>
                <p><strong>üì± –ü–æ—Å—Ç–æ–≤ –≤ –ê–Ø–ï–ß:</strong> ${s.postsCount}</p>
                <p><strong>üóëÔ∏è –ü—Ä–∏—ë–º–æ–≤ –ø–∏—â–∏ –∏–∑ –ø–æ–º–æ–π–∫–∏:</strong> ${s.trashMeals}</p>
                <p><strong>üçÜ –§–æ—Ç–æ–∫ –ø–µ–Ω–∏—Å–∞:</strong> ${s.dickPics}</p>
                <p><strong>üè• –í–∏–∑–∏—Ç–æ–≤ –≤ –±–æ–ª—å–Ω–∏—Ü—É:</strong> ${s.hospitalVisits}</p>
                <p><strong>üöø –†–∞–∑ –ø–æ–º—ã–ª—Å—è:</strong> ${s.washCount}</p>
                <p><strong>üßî –†–∞–∑ –ø–æ–±—Ä–∏–ª—Å—è:</strong> ${s.shaveCount}</p>
                <p><strong>üö∂ –í—ã—Ö–æ–¥–æ–≤ –∏–∑ –¥–æ–º–∞:</strong> ${s.outsideCount}</p>
                <p><strong>üöá –ü–æ–µ–∑–¥–æ–∫ –≤ –º–µ—Ç—Ä–æ:</strong> ${s.metroRides}</p>
                <p><strong>üö® –®—Ç—Ä–∞—Ñ–æ–≤ –æ—Ç –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä–æ–≤:</strong> ${s.metroFined}</p>
                <p><strong>üíÄ –ü–æ–ø—ã—Ç–æ–∫ —Å—É–∏—Ü–∏–¥–∞:</strong> ${s.suicideAttempts}</p>
            `;
            document.getElementById('statisticsContent').innerHTML = html;
            document.getElementById('statisticsModal').style.display = 'flex';
        }

        function closeStatistics() {
            document.getElementById('statisticsModal').style.display = 'none';
        }

        // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∏–≥—Ä—ã
        function restartGame() {
            gameState = {
                health: 100,
                mood: 50,
                satiety: 100,
                adequacy: 20,
                incel: 80,
                godComplex: 40,
                fatigue: 0,
                money: 25000,
                day: 1,
                vikaRelationship: 0,
                parentFoodToday: 0,
                satietyZeroDays: 0,
                daysInDepression: 0,
                daysInDebt: 0,
                hospitalToday: false,
                achievements: [],
                stats: {
                    totalMoneyEarned: 0,
                    workShifts: 0,
                    vikaCallsSuccess: 0,
                    vikaCallsFail: 0,
                    vikaMoneySpent: 0,
                    postsCount: 0,
                    trashMeals: 0,
                    dickPics: 0,
                    hospitalVisits: 0,
                    washCount: 0,
                    shaveCount: 0,
                    outsideCount: 0,
                    daysWithoutOutside: 0,
                    suicideAttempts: 0,
                    metroRides: 0,
                    metroFined: 0,
                    wasInDebt: false,
                    maxDebtDays: 0
                }
            };
            
            // CRITICAL: –û—á–∏—Å—Ç–∫–∞ –ª–æ–≥–∞
            const log = document.getElementById('eventLog');
            if (log) {
                log.innerHTML = ''; // –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞
                // –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ addLog
                addLog('<strong>üéÆ –ù–æ–≤–∞—è –∏–≥—Ä–∞!</strong><br>–¢—ã —Å–Ω–æ–≤–∞ –ú–∞—Ç–≤–µ–π. –ü–æ–ø—Ä–æ–±—É–π –ø—Ä–æ–∂–∏—Ç—å –¥–æ–ª—å—à–µ –Ω–∞ —ç—Ç–æ—Ç —Ä–∞–∑...', 'event');
            }
            
            // –°–±—Ä–æ—Å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
            updateAchievementsDisplay();
            
            document.getElementById('gameOverModal').style.display = 'none';
            
            // Restore Telegram Main Button
            if (isTelegram && tg) {
                tg.MainButton.show();
            }
            
            hapticFeedback('success');
            saveGame();
            updateUI();
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        document.addEventListener('DOMContentLoaded', () => {
            // CRITICAL: –û—á–∏—Å—Ç–∫–∞ event log –æ—Ç —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
            const eventLog = document.getElementById('eventLog');
            if (eventLog) {
                eventLog.innerHTML = ''; // –£–¥–∞–ª–∏—Ç—å –≤—Å–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ HTML —Å–æ–æ–±—â–µ–Ω–∏—è
            }
            
            // Initialize Telegram Web App
            const telegramInitialized = initTelegram();
            
            if (telegramInitialized) {
                console.log('üöÄ Running in Telegram Mini App');
                // Show share button in Telegram
                const shareBtn = document.getElementById('shareBtn');
                if (shareBtn) shareBtn.style.display = 'inline-flex';
                
                // Load from Telegram Cloud
                loadGameFromTelegram();
            } else {
                console.log('üåê Running in browser');
                updateUI();
            }
            
            updateAchievementsDisplay();
            checkAchievementsProgress();
            setupTutorialAutoClose();
            
            // Save on page hide
            window.addEventListener('pagehide', () => {
                saveGame();
            });
            
            window.addEventListener('beforeunload', () => {
                saveGame();
            });
        });
        
        // Show patch notes
        setTimeout(() => {
            if (!tutorialClosed) return;  // Don't show if tutorial is open
            
            const patchNotes = `<div style="background: #1a3a1a; border: 2px solid var(--color-success); padding: 15px; border-radius: 10px;">
                    <h3 style="color: var(--color-success); margin-bottom: 10px;">üìã TELEGRAM MINI APP v2.0</h3>
                    
                    ${isTelegram ? '<p style="color: #4a9eff; font-weight: bold;">üöÄ –ó–∞–ø—É—â–µ–Ω–æ –≤ Telegram!</p>' : '<p style="color: #ffaa00;">üåê –†–µ–∂–∏–º –±—Ä–∞—É–∑–µ—Ä–∞ (–¥–ª—è Telegram –æ—Ç–∫—Ä–æ–π—Ç–µ —á–µ—Ä–µ–∑ –±–æ—Ç–∞)</p>'}
                    
                    <h4 style="color: #4a9eff; margin-top: 10px;">‚ú® TELEGRAM –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø:</h4>
                    <ul style="line-height: 1.8; margin-left: 20px;">
                        <li>‚òÅÔ∏è <strong>Cloud Storage</strong> - –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –æ–±–ª–∞–∫–æ Telegram</li>
                        <li>üì≥ <strong>Haptic Feedback</strong> - —Ç–∞–∫—Ç–∏–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å –ø—Ä–∏ –¥–µ–π—Å—Ç–≤–∏—è—Ö</li>
                        <li>üé® <strong>–ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Ç–µ–º–∞</strong> - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ü–≤–µ—Ç–∞ Telegram</li>
                        <li>üíæ <strong>–ì–ª–∞–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞</strong> - –±—ã—Å—Ç—Ä–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–≥—Ä—ã</li>
                        <li>üì§ <strong>–ü–æ–¥–µ–ª–∏—Ç—å—Å—è</strong> - –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥—Ä—É–∑—å—è–º</li>
                        <li>üì± <strong>Touch UI</strong> - –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö</li>
                    </ul>
                    
                    <h4 style="color: #ff6666; margin-top: 10px;">üéØ –ß–¢–û –ù–û–í–û–ì–û –í v1.6:</h4>
                    
                    <h4 style="color: #ff6666; margin-top: 10px;">üéØ –ù–û–í–û–ï –í v1.6:</h4>
                    <ul style="line-height: 1.8; margin-left: 20px;">
                        <li>üîû <strong>–î—Ä–æ—á–∫–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞ –ø—Ä–∏ —É—Å—Ç–∞–ª–æ—Å—Ç–∏ ‚â•80</strong> - –ª–æ–≥–∏—á–Ω–æ, —á—Ç–æ —É—Å—Ç–∞–≤—à–∏–π —á–µ–ª–æ–≤–µ–∫ –Ω–µ –º–æ–∂–µ—Ç —ç—Ç–æ–≥–æ –¥–µ–ª–∞—Ç—å</li>
                        <li>‚ö†Ô∏è <strong>–í–∏–∑—É–∞–ª—å–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–Ω–æ–ø–∫–∏</strong> - –∫–Ω–æ–ø–∫–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Å–µ—Ä–æ–π –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–∏—á–∏–Ω—É</li>
                        <li>üí¨ <strong>–°–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ</strong> - "–°–ª–∏—à–∫–æ–º —É—Å—Ç–∞–ª –¥–∞–∂–µ –¥–ª—è —ç—Ç–æ–≥–æ..."</li>
                        <li>üí§ <strong>–†–µ—à–µ–Ω–∏–µ</strong> - –Ω—É–∂–Ω–æ –ø–æ—Å–ø–∞—Ç—å, —á—Ç–æ–±—ã —Å–Ω–∏–∑–∏—Ç—å —É—Å—Ç–∞–ª–æ—Å—Ç—å –≤–¥–≤–æ–µ</li>
                    </ul>
                    
                    <h4 style="color: #4a9eff; margin-top: 10px;">‚öñÔ∏è –ë–ê–õ–ê–ù–° –ò–ì–†–´:</h4>
                    <ul style="line-height: 1.8; margin-left: 20px;">
                        <li>‚úÖ –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω—ã –∏ –∏–º–µ—é—Ç –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è</li>
                        <li>‚úÖ –£—Å—Ç–∞–ª–æ—Å—Ç—å —Ç–µ–ø–µ—Ä—å –±–ª–æ–∫–∏—Ä—É–µ—Ç: —Ä–∞–±–æ—Ç—É, –ø—Ä–æ–≥—É–ª–∫–∏, –ø–æ—Å—Ç–∏–Ω–≥, –º–µ—Ç—Ä–æ, <strong>–î–†–û–ß–ö–£</strong></li>
                        <li>‚úÖ –ö–æ–º–ø–ª–µ–∫—Å –±–æ–≥–∞ –±–ª–æ–∫–∏—Ä—É–µ—Ç: –≥–∏–≥–∏–µ–Ω—É –∏ –≤—ã—Ö–æ–¥ –∏–∑ –¥–æ–º–∞</li>
                        <li>‚úÖ –î–µ–Ω—å–≥–∏/–ø–∞—Ä–∞–º–µ—Ç—Ä—ã –±–ª–æ–∫–∏—Ä—É—é—Ç: –í–∏–∫—É, –ú–∞–º–±—É, –±–æ–ª—å–Ω–∏—Ü—É</li>
                    </ul>
                    
                    <p style="margin-top: 15px; color: var(--color-success); font-weight: bold;">üéÆ –ò–ì–†–ê –ì–û–¢–û–í–ê! –í—Å–µ –º–µ—Ö–∞–Ω–∏–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ! üöÄ</p>
                </div>`;
            
            // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å addLog –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
            addLog(patchNotes, 'event');
        }, 500);
    </script>
</body>
</html>